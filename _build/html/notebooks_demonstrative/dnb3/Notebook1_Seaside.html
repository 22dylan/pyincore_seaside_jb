
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IN-CORE Flowchart - Seaside &#8212; Seaside Notebook Gallery</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Spatial Bayesian Network" href="../../notebooks_research/rnb1/SBN.html" />
    <link rel="prev" title="Community Description" href="../dnb2/Seaside_CommDescription.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      <img src="../../_static/resilience_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Seaside Notebook Gallery</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Seaside Notebook Gallery
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Demonstrative Notebooks
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../dnb1/Seaside_testbed.html">
   Building Damage
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dnb2/Seaside_CommDescription.html">
   Community Description
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   IN-CORE Flowchart - Seaside
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Research Notebooks
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../notebooks_research/rnb1/SBN.html">
   Spatial Bayesian Network
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  References
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../ref/ref.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/notebooks_demonstrative/dnb3/Notebook1_Seaside.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/notebooks_demonstrative/dnb3/Notebook1_Seaside.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#background">
   Background
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#start">
   Start
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#initial-community-description">
   1) Initial Community Description
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-built-environment">
     1a) Built Environment
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#buildings">
       Buildings
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#electric">
       Electric
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#transportation">
       Transportation
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#water">
       Water
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#b-social-systems">
     1b) Social Systems
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#explore-results-from-housing-unit-allocation">
       Explore results from Housing Unit Allocation
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#c-economic-systems">
     1c) Economic Systems
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#hazards-and-damages">
   2) Hazards and Damages
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-hazard-models">
     2a) Hazard Models
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#b-damage-models">
     2b) Damage Models
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#plotting-some-example-fragility-curves">
       Plotting some example fragility curves
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#setting-up-a-function-to-read-monte-carlo-results">
       Setting up a function to read Monte-Carlo results.
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#setting-up-an-alternative-plotting-function-to-plot-buildings-spatially">
       Setting up an alternative plotting function to plot buildings spatially.
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#setting-up-a-quick-way-to-read-pyincore-datasets-into-either-dataframes-or-geodataframes">
       Setting up a quick way to read pyIncore datasets into either dataframes or geodataframes.
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#c-damage-to-physical-infrastructure">
     2c) Damage to Physical Infrastructure
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#building-damage">
       Building Damage
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#electric-damage">
       Electric Damage
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#transportation-damage">
       Transportation Damage
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#water-damage">
       Water Damage
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#functionality">
   3) Functionality
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-functionality-models">
     3a) Functionality Models
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#building-functionality-model">
       Building Functionality Model
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#electric-functionality-model">
       Electric Functionality Model
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#transportation-functionality-model">
       Transportation Functionality Model
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#water-functionality-model">
       Water Functionality Model
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#b-functionality-of-physical-infrastructure">
     3b) Functionality of Physical Infrastructure
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#building-functionality">
       Building Functionality
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#electric-functionality">
       Electric Functionality
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#transportation-functionality">
       Transportation Functionality
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#water-functionality">
       Water Functionality
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#c-cge-model">
     3c) CGE Model
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#getting-building-failure-results">
       Getting building failure results
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#capital-shock-analysis">
       Capital Shock Analysis
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#showings-results-from-capital-shock">
       Showings results from capital shock
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#running-cge">
       Running CGE
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#d-social-science-modules">
     3d) Social Science Modules
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#e-direct-and-indirect-economic-social-losses">
     3e) Direct and Indirect Economic &amp; Social Losses
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#recovery">
   4) Recovery
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     4) Recovery
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#electric-recovery">
       Electric Recovery
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#transportation-recovery">
       Transportation Recovery
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#water-recovery">
       Water Recovery
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="in-core-flowchart-seaside">
<h1>IN-CORE Flowchart - Seaside<a class="headerlink" href="#in-core-flowchart-seaside" title="Permalink to this headline">¶</a></h1>
<p>This notebook uses the Seaside testbed to demonstrate the following components of the IN-CORE flowchart.</p>
<ul class="simple">
<li><p><a class="reference external" href="#0">Start</a></p></li>
<li><p><a class="reference external" href="#1">1. Initial Community Description</a></p>
<ul>
<li><p><a class="reference external" href="#1a">1a. Built Environment</a></p></li>
<li><p><a class="reference external" href="#1b">1b. Social Systems</a></p></li>
<li><p><a class="reference external" href="#1c">1c. Economic Systems</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#2">2. Hazards and Damages</a></p>
<ul>
<li><p><a class="reference external" href="#2a">2a. Hazard Models</a></p></li>
<li><p><a class="reference external" href="#2b">2b. Damage Models</a></p></li>
<li><p><a class="reference external" href="#2c">2c. Damage to Physical Infrastructure</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#3">3. Functionality</a></p>
<ul>
<li><p><a class="reference external" href="#3a">3a. Functionality Models</a></p></li>
<li><p><a class="reference external" href="#3b">3b. Functionality of Physical Infrastructure</a></p></li>
<li><p><a class="reference external" href="#3c">3c. CGE Model</a></p></li>
<li><p><a class="reference external" href="#3d">3d. Social Science Modules</a></p></li>
<li><p><a class="reference external" href="#3e">3e. Direct and Indirect Economic &amp; Social Losses</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#4">4. Recovery</a></p></li>
<li><p><a class="reference external" href="#ref">References</a></p></li>
</ul>
<!-- *Notebook created by Dylan R. Sanderson (OSU - sanderdy@oregonstate.edu) -->
<p><img alt="title" src="../../_images/Flowchart_01.png" /><br></p>
<hr class="docutils" />
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>The North American Pacific Northwest is subject to the rupture of the Cascadia Subduction Zone (CSZ), which is an approximately 1,000 km long fault located between Cape Mendocino California and Vancouver Island, Canada, and separates the Juan de Fuca and North America plates. Rupture of the CSZ can result in both strong earthquake ground shaking and tsunami inundation. The last full rupture of the CSZ occurred in 1700 and is estimated to have had a moment magnitude between 8.7 and 9.2. The city of Seaside is a small coastal town located along the northern Oregon coast, and has a full-time population of approximately 6,700 people. As a popular coastal town, Seaside see’s large population flucuations both seasonally (e.g. winter vs. summer population) and weekly (e.g. weekday vs. weekend population).</p>
<p>Here, Seaside is employed as a testbed community to demonstrate how IN-CORE can be used for communities subject to multiple hazards. The small size of Seaside naturally enables a fine level of analysis leading to a high level of detail. The analysis in this notebook are at the parcel level, which is defined as the size of a tax-lot and roughly corresponds to a single building.</p>
<p><img alt="title" src="../../_images/seaside2.png" /><br></p>
<p><a id='0'></a></p>
</div>
<hr class="docutils" />
<div class="section" id="start">
<h2>Start<a class="headerlink" href="#start" title="Permalink to this headline">¶</a></h2>
<p><strong>Importing all of the pyIncore modules used for this notebook</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyincore</span> <span class="kn">import</span> <span class="n">IncoreClient</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">DataService</span><span class="p">,</span> <span class="n">HazardService</span><span class="p">,</span> <span class="n">FragilityService</span>
<span class="kn">from</span> <span class="nn">pyincore</span> <span class="kn">import</span> <span class="n">FragilityCurveSet</span><span class="p">,</span> <span class="n">MappingSet</span>
<span class="kn">from</span> <span class="nn">pyincore_viz.geoutil</span> <span class="kn">import</span> <span class="n">GeoUtil</span> <span class="k">as</span> <span class="n">geoviz</span>
<span class="kn">from</span> <span class="nn">pyincore_viz.plotutil</span> <span class="kn">import</span> <span class="n">PlotUtil</span> <span class="k">as</span> <span class="n">plotviz</span>

<span class="kn">from</span> <span class="nn">pyincore.analyses.housingunitallocation</span> <span class="kn">import</span> <span class="n">HousingUnitAllocation</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.populationdislocation</span> <span class="kn">import</span> <span class="n">PopulationDislocation</span><span class="p">,</span> <span class="n">PopulationDislocationUtil</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.buildingdamage</span> <span class="kn">import</span> <span class="n">BuildingDamage</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.buildingfunctionality</span> <span class="kn">import</span> <span class="n">BuildingFunctionality</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.montecarlofailureprobability</span> <span class="kn">import</span> <span class="n">MonteCarloFailureProbability</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.cumulativebuildingdamage</span> <span class="kn">import</span> <span class="n">CumulativeBuildingDamage</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.epfdamage</span> <span class="kn">import</span> <span class="n">EpfDamage</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.bridgedamage</span> <span class="kn">import</span> <span class="n">BridgeDamage</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.roaddamage</span> <span class="kn">import</span> <span class="n">RoadDamage</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.pipelinedamage</span> <span class="kn">import</span> <span class="n">PipelineDamage</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.pipelinedamagerepairrate</span> <span class="kn">import</span> <span class="n">PipelineDamageRepairRate</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.waterfacilitydamage</span> <span class="kn">import</span> <span class="n">WaterFacilityDamage</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.capitalshocks</span> <span class="kn">import</span> <span class="n">CapitalShocks</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.seasidecge</span> <span class="kn">import</span> <span class="n">SeasideCGEModel</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="nn">ctx</span>


<span class="n">client</span> <span class="o">=</span> <span class="n">IncoreClient</span><span class="p">()</span>
<span class="n">data_service</span> <span class="o">=</span> <span class="n">DataService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">hazard_service</span> <span class="o">=</span> <span class="n">HazardService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">fragility_services</span> <span class="o">=</span> <span class="n">FragilityService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1337</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Connection successful to IN-CORE services. pyIncore version detected: 1.0.0
</pre></div>
</div>
</div>
</div>
<p><strong>Defining recurrence interval to consider and number of MC simulations</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ret_prd</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Hazard Recurrence Interval: &#39;</span><span class="p">))</span>
<span class="n">n_sims</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Number of MC Simulations: &#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Hazard Recurrence Interval: 500
Number of MC Simulations: 10
</pre></div>
</div>
</div>
</div>
<p><strong>Defining output directory and creating it if does not exist</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path_to_output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">yr&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id='1'></a></p>
</div>
<hr class="docutils" />
<div class="section" id="initial-community-description">
<h2>1) Initial Community Description<a class="headerlink" href="#initial-community-description" title="Permalink to this headline">¶</a></h2>
<p><img alt="title" src="../../_images/Flowchart_1b.png" /><br></p>
<p><a id='1a'></a></p>
<div class="section" id="a-built-environment">
<h3>1a) Built Environment<a class="headerlink" href="#a-built-environment" title="Permalink to this headline">¶</a></h3>
<p>The Seaside testbed consists of four infrastructure systems (buildings, electric, transportation, and water). Each infrastructure system may be composed of different infrastructure components. For example, the electric power network consists of electric lines and poles.</p>
<p>The infrastructure systems and components are shown below along with their IN-CORE GUID.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Infrastructure System</p></th>
<th class="head"><p>Infrastructure Component</p></th>
<th class="head"><p>GUID</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Buildings</p></td>
<td><p>-</p></td>
<td><p>613ba5ef5d3b1d6461e8c415</p></td>
</tr>
<tr class="row-odd"><td><p>Electric</p></td>
<td><p>Electric Poles</p></td>
<td><p>5d263f08b9219cf93c056c68</p></td>
</tr>
<tr class="row-even"><td><p>-</p></td>
<td><p>Electric Lines</p></td>
<td><p>60e5e326544e944c3ce37a93</p></td>
</tr>
<tr class="row-odd"><td><p>Transportation</p></td>
<td><p>Roads</p></td>
<td><p>60e5e5cd544e944c3ce37d08</p></td>
</tr>
<tr class="row-even"><td><p>-</p></td>
<td><p>Bridges</p></td>
<td><p>60e5e576d3c92a78c893ff69</p></td>
</tr>
<tr class="row-odd"><td><p>Water</p></td>
<td><p>Water Pumping Stations</p></td>
<td><p>60e5e91960b3f41243faa3b2</p></td>
</tr>
<tr class="row-even"><td><p>-</p></td>
<td><p>Water Treatment Plant</p></td>
<td><p>60e5e91960b3f41243faa3b2</p></td>
</tr>
<tr class="row-odd"><td><p>-</p></td>
<td><p>Water Pipes</p></td>
<td><p>60e72f9fd3c92a78c89636c7</p></td>
</tr>
</tbody>
</table>
<p>This section:</p>
<ul class="simple">
<li><p>Reads in Seaside infrastructure systems from the pyIncore dataservice as a dataset object</p></li>
<li><p>Uses pyincore_viz to plot infrastructure components</p></li>
</ul>
<div class="section" id="buildings">
<h4>Buildings<a class="headerlink" href="#buildings" title="Permalink to this headline">¶</a></h4>
<p>The building inventory for Seaside was originally collected by Park <em>et al.</em> (2017a) using a combination of tax-lot assessor data, field data collection, and Google street view. The terms parcels and buildings are used interchangeably.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bldg_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;613ba5ef5d3b1d6461e8c415&quot;</span>        <span class="c1"># defining building dataset (GIS point layer)</span>
<span class="n">bldg_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_data_service</span><span class="p">(</span><span class="n">bldg_dataset_id</span><span class="p">,</span> <span class="n">data_service</span><span class="p">)</span>
<span class="n">geoviz</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">bldg_dataset</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;struct_typ&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>
<span class="n">bldg_df</span> <span class="o">=</span> <span class="n">bldg_dataset</span><span class="o">.</span><span class="n">get_dataframe_from_shapefile</span><span class="p">()</span>
<span class="n">bldg_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of buildings: </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bldg_df</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Number of buildings: 4679
</pre></div>
</div>
<img alt="../../_images/Notebook1_Seaside_11_1.png" src="../../_images/Notebook1_Seaside_11_1.png" />
</div>
</div>
</div>
<div class="section" id="electric">
<h4>Electric<a class="headerlink" href="#electric" title="Permalink to this headline">¶</a></h4>
<p>The electric infrastructure was originallly collected by Kameshwar <em>et al.</em> (2019) and consists of electric poles, an electric substation, and electric power lines. Each building parcel in Seaside is mapped to the nearest electric pole.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">elec_pole_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;5d263f08b9219cf93c056c68&quot;</span>        <span class="c1"># defining electric pole dataset (GIS point layer)</span>
<span class="n">elec_pole_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_data_service</span><span class="p">(</span><span class="n">elec_pole_dataset_id</span><span class="p">,</span> <span class="n">data_service</span><span class="p">)</span>
<span class="n">geoviz</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">elec_pole_dataset</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="n">elec_line_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;60e5e326544e944c3ce37a93&quot;</span>        <span class="c1"># defining electric line dataset (GIS point layer)</span>
<span class="n">elec_line_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_data_service</span><span class="p">(</span><span class="n">elec_line_dataset_id</span><span class="p">,</span> <span class="n">data_service</span><span class="p">)</span>
<span class="n">geoviz</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">elec_line_dataset</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<img alt="../../_images/Notebook1_Seaside_13_1.png" src="../../_images/Notebook1_Seaside_13_1.png" />
<img alt="../../_images/Notebook1_Seaside_13_2.png" src="../../_images/Notebook1_Seaside_13_2.png" />
</div>
</div>
</div>
<div class="section" id="transportation">
<h4>Transportation<a class="headerlink" href="#transportation" title="Permalink to this headline">¶</a></h4>
<p>The transportation infrastructure was originallly collected by Kameshwar <em>et al.</em> (2019) and consists of roads and bridges. Each parcel in Seaside is mapped to the nearest node in the transportation network.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trns_road_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;60e5e5cd544e944c3ce37d08&quot;</span>        <span class="c1"># defining transportation road dataset (GIS point layer)</span>
<span class="n">trns_road_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_data_service</span><span class="p">(</span><span class="n">trns_road_dataset_id</span><span class="p">,</span> <span class="n">data_service</span><span class="p">)</span>
<span class="n">geoviz</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">trns_road_dataset</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="n">trns_brdg_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;60e5e576d3c92a78c893ff69&quot;</span>        <span class="c1"># defining transportation bridge dataset (GIS point layer)</span>
<span class="n">trns_brdg_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_data_service</span><span class="p">(</span><span class="n">trns_brdg_dataset_id</span><span class="p">,</span> <span class="n">data_service</span><span class="p">)</span>
<span class="n">geoviz</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">trns_brdg_dataset</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">basemap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<img alt="../../_images/Notebook1_Seaside_15_1.png" src="../../_images/Notebook1_Seaside_15_1.png" />
<img alt="../../_images/Notebook1_Seaside_15_2.png" src="../../_images/Notebook1_Seaside_15_2.png" />
</div>
</div>
</div>
<div class="section" id="water">
<h4>Water<a class="headerlink" href="#water" title="Permalink to this headline">¶</a></h4>
<p>The water infrastructure was originallly collected by Kameshwar <em>et al.</em> (2019) and consists of water pipes, a water treatment plant, and three water pumping stations. Each building parcel in Seaside is mapped to the nearest node in the water network.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wter_pipe_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;60e72f9fd3c92a78c89636c7&quot;</span>        <span class="c1"># defining water pipes (GIS point layer)</span>
<span class="n">wter_pipe_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_data_service</span><span class="p">(</span><span class="n">wter_pipe_dataset_id</span><span class="p">,</span> <span class="n">data_service</span><span class="p">)</span>
<span class="n">geoviz</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">wter_pipe_dataset</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">wter_fclty_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;60e5e91960b3f41243faa3b2&quot;</span>        <span class="c1"># defining water facilities (GIS point layer)</span>
<span class="n">wter_fclty_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_data_service</span><span class="p">(</span><span class="n">wter_fclty_dataset_id</span><span class="p">,</span> <span class="n">data_service</span><span class="p">)</span>
<span class="n">geoviz</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">wter_fclty_dataset</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;utilfcltyc&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<img alt="../../_images/Notebook1_Seaside_17_1.png" src="../../_images/Notebook1_Seaside_17_1.png" />
<img alt="../../_images/Notebook1_Seaside_17_2.png" src="../../_images/Notebook1_Seaside_17_2.png" />
</div>
</div>
<p><a id='1b'></a></p>
</div>
</div>
<div class="section" id="b-social-systems">
<h3>1b) Social Systems<a class="headerlink" href="#b-social-systems" title="Permalink to this headline">¶</a></h3>
<p>Seaside has a permanent resident population of approximately 6,700 people.</p>
<p>This section performs a housing unit allocation. The housing unit inventory includes characteristics for individual households and housing units that can be linked to residential buildings.
For more information see Rosenheim et al. (2019)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create housing allocation </span>
<span class="n">hua</span> <span class="o">=</span> <span class="n">HousingUnitAllocation</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="c1"># Load input dataset</span>
<span class="n">housing_unit_inv_id</span> <span class="o">=</span> <span class="s2">&quot;5d543087b9219c0689b98234&quot;</span>
<span class="n">address_point_inv_id</span> <span class="o">=</span> <span class="s2">&quot;5d542fefb9219c0689b981fb&quot;</span>
<span class="n">bldg_inv_id</span> <span class="o">=</span> <span class="s2">&quot;613ba5ef5d3b1d6461e8c415&quot;</span> 

<span class="n">hua</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;housing_unit_inventory&quot;</span><span class="p">,</span> <span class="n">housing_unit_inv_id</span><span class="p">)</span>
<span class="n">hua</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;address_point_inventory&quot;</span><span class="p">,</span> <span class="n">address_point_inv_id</span><span class="p">)</span>
<span class="n">hua</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;buildings&quot;</span><span class="p">,</span> <span class="n">bldg_inv_id</span><span class="p">)</span> 


<span class="c1"># Set analysis parameters</span>
<span class="n">path_out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;hua_0&#39;</span><span class="p">)</span>
<span class="n">hua</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">path_out</span><span class="p">)</span>
<span class="n">hua</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;seed&quot;</span><span class="p">,</span> <span class="mi">1337</span><span class="p">)</span>
<span class="n">hua</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;iterations&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">hua</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="section" id="explore-results-from-housing-unit-allocation">
<h4>Explore results from Housing Unit Allocation<a class="headerlink" href="#explore-results-from-housing-unit-allocation" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Retrieve result dataset</span>
<span class="n">hua_result</span> <span class="o">=</span> <span class="n">hua</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">)</span>

<span class="c1"># Convert dataset to Pandas DataFrame</span>
<span class="n">hua_df</span> <span class="o">=</span> <span class="n">hua_result</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">(</span><span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Display top 5 rows of output data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hua_df</span><span class="p">[[</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span><span class="s1">&#39;numprec&#39;</span><span class="p">,</span><span class="s1">&#39;ownershp&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span><span class="s1">&#39;aphumerge&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="c1"># keep observations where the housing unit characteristics have been allocated to a structure.</span>
<span class="n">hua_df</span> <span class="o">=</span> <span class="n">hua_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;guid&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                   guid  numprec  ownershp  \
0  37532fb5-5107-478b-ab2c-158eb001c68b      3.0       1.0   
1  e38d8575-7880-4a8c-b6d7-225ab1cf9264      3.0       1.0   
2  66d39314-1c68-4634-a82c-8fcb37f529ff      3.0       1.0   
3  af5771b4-4f42-4166-b772-78a3706fa8ac      1.0       1.0   
4  8f6e055b-2df8-461b-80a0-ba0c1f65add5      7.0       1.0   

                                       geometry aphumerge  
0  POINT (-123.9034265041881 46.01749849919388)      both  
1  POINT (-123.8960661064165 46.01272230816045)      both  
2  POINT (-123.9002451964179 46.01352343272472)      both  
3  POINT (-123.9034265041881 46.01749849919388)      both  
4  POINT (-123.8971825599634 46.01202832179288)      both  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hua_df</span><span class="p">[</span><span class="s1">&#39;Race Ethnicity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0 Vacant HU No Race Ethnicity Data&quot;</span>
<span class="n">hua_df</span><span class="p">[</span><span class="s1">&#39;Race Ethnicity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notes</span> <span class="o">=</span> <span class="s2">&quot;Identify Race and Ethnicity Housing Unit Characteristics.&quot;</span>

<span class="n">hua_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">hua_df</span><span class="p">[</span><span class="s1">&#39;race&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> 
                        <span class="p">(</span><span class="n">hua_df</span><span class="p">[</span><span class="s1">&#39;hispan&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span><span class="s1">&#39;Race Ethnicity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1 White alone, Not Hispanic&quot;</span>
<span class="n">hua_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">hua_df</span><span class="p">[</span><span class="s1">&#39;race&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> 
                        <span class="p">(</span><span class="n">hua_df</span><span class="p">[</span><span class="s1">&#39;hispan&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span><span class="s1">&#39;Race Ethnicity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;2 Black alone, Not Hispanic&quot;</span>
<span class="n">hua_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">hua_df</span><span class="p">[</span><span class="s1">&#39;race&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">]))</span> <span class="o">&amp;</span> 
                        <span class="p">(</span><span class="n">hua_df</span><span class="p">[</span><span class="s1">&#39;hispan&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span><span class="s1">&#39;Race Ethnicity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;3 Other Race, Not Hispanic&quot;</span>
<span class="n">hua_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">hua_df</span><span class="p">[</span><span class="s1">&#39;hispan&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span><span class="s1">&#39;Race Ethnicity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;4 Any Race, Hispanic&quot;</span>
<span class="n">hua_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">hua_df</span><span class="p">[</span><span class="s1">&#39;gqtype&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">),</span><span class="s1">&#39;Race Ethnicity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;5 Group Quarters no Race Ethnicity Data&quot;</span>

<span class="n">hua_df</span><span class="p">[</span><span class="s1">&#39;Tenure Status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0 No Tenure Status&quot;</span>
<span class="n">hua_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">hua_df</span><span class="p">[</span><span class="s1">&#39;ownershp&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span><span class="s1">&#39;Tenure Status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1 Owner Occupied&quot;</span>
<span class="n">hua_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">hua_df</span><span class="p">[</span><span class="s1">&#39;ownershp&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">),</span><span class="s1">&#39;Tenure Status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;2 Renter Occupied&quot;</span>
<span class="n">hua_df</span><span class="p">[</span><span class="s1">&#39;Tenure Status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notes</span> <span class="o">=</span> <span class="s2">&quot;Identify Tenure Status Housing Unit Characteristics.&quot;</span>

<span class="n">hua_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;hua_df.csv&#39;</span><span class="p">))</span>

<span class="c1"># make pivot table</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">hua_df</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;numprec&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Race Ethnicity&#39;</span><span class="p">],</span>
                                     <span class="n">margins</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">margins_name</span> <span class="o">=</span> <span class="s1">&#39;Total&#39;</span><span class="p">,</span>
                                     <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Tenure Status&#39;</span><span class="p">],</span> <span class="n">aggfunc</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Total&#39;</span><span class="p">:</span> <span class="s1">&#39;Total Population&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">})</span>
<span class="n">table_title</span> <span class="o">=</span> <span class="s2">&quot;Table 1. Total Population by Race, Ethncity, and Tenure Status, Seaside, OR, 2010.&quot;</span>
<span class="n">varformat</span> <span class="o">=</span> <span class="p">{(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;Total Population&#39;</span><span class="p">):</span> <span class="s2">&quot;</span><span class="si">{:,.0f}</span><span class="s2">&quot;</span><span class="p">,</span>
             <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;0 No Tenure Status&#39;</span><span class="p">):</span> <span class="s2">&quot;</span><span class="si">{:,.0f}</span><span class="s2">&quot;</span><span class="p">,</span>
             <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;1 Owner Occupied&#39;</span><span class="p">):</span> <span class="s2">&quot;</span><span class="si">{:,.0f}</span><span class="s2">&quot;</span><span class="p">,</span>
             <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;2 Renter Occupied&#39;</span><span class="p">):</span> <span class="s2">&quot;</span><span class="si">{:,.0f}</span><span class="s2">&quot;</span><span class="p">}</span>
<span class="n">table</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="n">table_title</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">varformat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
</style>
<table id="T_0219a_">
  <caption>Table 1. Total Population by Race, Ethncity, and Tenure Status, Seaside, OR, 2010.</caption>
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" colspan="4"></th>
    </tr>
    <tr>
      <th class="index_name level1" >Tenure Status</th>
      <th class="col_heading level1 col0" >0 No Tenure Status</th>
      <th class="col_heading level1 col1" >1 Owner Occupied</th>
      <th class="col_heading level1 col2" >2 Renter Occupied</th>
      <th class="col_heading level1 col3" >Total Population</th>
    </tr>
    <tr>
      <th class="index_name level0" >Race Ethnicity</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
      <th class="blank col3" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_0219a_level0_row0" class="row_heading level0 row0" >0 Vacant HU No Race Ethnicity Data</th>
      <td id="T_0219a_row0_col0" class="data row0 col0" >0</td>
      <td id="T_0219a_row0_col1" class="data row0 col1" >nan</td>
      <td id="T_0219a_row0_col2" class="data row0 col2" >nan</td>
      <td id="T_0219a_row0_col3" class="data row0 col3" >0</td>
    </tr>
    <tr>
      <th id="T_0219a_level0_row1" class="row_heading level0 row1" >1 White alone, Not Hispanic</th>
      <td id="T_0219a_row1_col0" class="data row1 col0" >nan</td>
      <td id="T_0219a_row1_col1" class="data row1 col1" >2,631</td>
      <td id="T_0219a_row1_col2" class="data row1 col2" >2,899</td>
      <td id="T_0219a_row1_col3" class="data row1 col3" >5,530</td>
    </tr>
    <tr>
      <th id="T_0219a_level0_row2" class="row_heading level0 row2" >2 Black alone, Not Hispanic</th>
      <td id="T_0219a_row2_col0" class="data row2 col0" >nan</td>
      <td id="T_0219a_row2_col1" class="data row2 col1" >7</td>
      <td id="T_0219a_row2_col2" class="data row2 col2" >17</td>
      <td id="T_0219a_row2_col3" class="data row2 col3" >24</td>
    </tr>
    <tr>
      <th id="T_0219a_level0_row3" class="row_heading level0 row3" >3 Other Race, Not Hispanic</th>
      <td id="T_0219a_row3_col0" class="data row3 col0" >nan</td>
      <td id="T_0219a_row3_col1" class="data row3 col1" >136</td>
      <td id="T_0219a_row3_col2" class="data row3 col2" >191</td>
      <td id="T_0219a_row3_col3" class="data row3 col3" >327</td>
    </tr>
    <tr>
      <th id="T_0219a_level0_row4" class="row_heading level0 row4" >4 Any Race, Hispanic</th>
      <td id="T_0219a_row4_col0" class="data row4 col0" >nan</td>
      <td id="T_0219a_row4_col1" class="data row4 col1" >187</td>
      <td id="T_0219a_row4_col2" class="data row4 col2" >530</td>
      <td id="T_0219a_row4_col3" class="data row4 col3" >717</td>
    </tr>
    <tr>
      <th id="T_0219a_level0_row5" class="row_heading level0 row5" >5 Group Quarters no Race Ethnicity Data</th>
      <td id="T_0219a_row5_col0" class="data row5 col0" >47</td>
      <td id="T_0219a_row5_col1" class="data row5 col1" >nan</td>
      <td id="T_0219a_row5_col2" class="data row5 col2" >nan</td>
      <td id="T_0219a_row5_col3" class="data row5 col3" >47</td>
    </tr>
    <tr>
      <th id="T_0219a_level0_row6" class="row_heading level0 row6" >Total</th>
      <td id="T_0219a_row6_col0" class="data row6 col0" >47</td>
      <td id="T_0219a_row6_col1" class="data row6 col1" >2,961</td>
      <td id="T_0219a_row6_col2" class="data row6 col2" >3,637</td>
      <td id="T_0219a_row6_col3" class="data row6 col3" >6,645</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use shapely.wkt loads to convert WKT to GeoSeries</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span>
<span class="c1"># Geodata frame requires geometry and CRS to be set</span>
<span class="n">hua_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
    <span class="n">hua_df</span><span class="p">,</span>
    <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">,</span>
    <span class="n">geometry</span><span class="o">=</span><span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span> <span class="k">for</span> <span class="n">xy</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">hua_df</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">hua_df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])])</span>
<span class="n">hua_gdf</span><span class="p">[[</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;ownershp&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

<span class="c1"># visualize population</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">hua_gdf</span>
<span class="n">geoviz</span><span class="o">.</span><span class="n">plot_gdf_map</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;ownershp&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Notebook1_Seaside_23_0.png" src="../../_images/Notebook1_Seaside_23_0.png" />
</div>
</div>
<p><a id='1c'></a></p>
</div>
</div>
<div class="section" id="c-economic-systems">
<h3>1c) Economic Systems<a class="headerlink" href="#c-economic-systems" title="Permalink to this headline">¶</a></h3>
<p>For the CGE model, each parcel is mapped to an economic sector. The sector of each parcel is plotted spatially.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bldg2sector_id</span> <span class="o">=</span> <span class="s2">&quot;5f5fd8e2980a301080a03996&quot;</span>
<span class="n">bldg2sector_ds</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_data_service</span><span class="p">(</span><span class="n">bldg2sector_id</span><span class="p">,</span> <span class="n">data_service</span><span class="p">)</span>
<span class="n">bldg2sector_df</span> <span class="o">=</span> <span class="n">bldg2sector_ds</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>

<span class="n">bldg_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;613ba5ef5d3b1d6461e8c415&quot;</span>        <span class="c1"># defining building dataset (GIS point layer)</span>
<span class="n">bldg_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_data_service</span><span class="p">(</span><span class="n">bldg_dataset_id</span><span class="p">,</span> <span class="n">data_service</span><span class="p">)</span>
<span class="n">bldg_dataset_df</span> <span class="o">=</span> <span class="n">bldg_dataset</span><span class="o">.</span><span class="n">get_dataframe_from_shapefile</span><span class="p">()</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">bldg_dataset_df</span><span class="p">,</span> <span class="n">bldg2sector_df</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;guid&#39;</span><span class="p">)</span>
<span class="n">geoviz</span><span class="o">.</span><span class="n">plot_gdf_map</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;sector&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<img alt="../../_images/Notebook1_Seaside_25_1.png" src="../../_images/Notebook1_Seaside_25_1.png" />
</div>
</div>
<p><strong>Showing count of number of parcels in each sector</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span><span class="s1">&#39;sector&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;sector&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>guid</th>
    </tr>
    <tr>
      <th>sector</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ACCOM1</th>
      <td>19</td>
    </tr>
    <tr>
      <th>ACCOM2</th>
      <td>15</td>
    </tr>
    <tr>
      <th>AG2</th>
      <td>1</td>
    </tr>
    <tr>
      <th>AG3</th>
      <td>1</td>
    </tr>
    <tr>
      <th>CONST1</th>
      <td>2</td>
    </tr>
    <tr>
      <th>CONST2</th>
      <td>11</td>
    </tr>
    <tr>
      <th>CONST3</th>
      <td>10</td>
    </tr>
    <tr>
      <th>HC1</th>
      <td>2</td>
    </tr>
    <tr>
      <th>HC2</th>
      <td>17</td>
    </tr>
    <tr>
      <th>HC3</th>
      <td>5</td>
    </tr>
    <tr>
      <th>HS1</th>
      <td>1297</td>
    </tr>
    <tr>
      <th>HS2</th>
      <td>947</td>
    </tr>
    <tr>
      <th>HS3</th>
      <td>637</td>
    </tr>
    <tr>
      <th>MANUF2</th>
      <td>7</td>
    </tr>
    <tr>
      <th>REST1</th>
      <td>24</td>
    </tr>
    <tr>
      <th>REST2</th>
      <td>22</td>
    </tr>
    <tr>
      <th>RETAIL1</th>
      <td>15</td>
    </tr>
    <tr>
      <th>RETAIL2</th>
      <td>49</td>
    </tr>
    <tr>
      <th>RETAIL3</th>
      <td>1</td>
    </tr>
    <tr>
      <th>SERV1</th>
      <td>35</td>
    </tr>
    <tr>
      <th>SERV2</th>
      <td>157</td>
    </tr>
    <tr>
      <th>SERV3</th>
      <td>258</td>
    </tr>
    <tr>
      <th>UTIL</th>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Showing the real market value of parcels by sector</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;rmv_improv&#39;</span><span class="p">,</span><span class="s1">&#39;sector&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;sector&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">dic_capital</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">dic_capital</span><span class="p">[</span><span class="s1">&#39;ACCOM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">dic_capital</span><span class="p">[</span><span class="s1">&#39;AG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">dic_capital</span><span class="p">[</span><span class="s1">&#39;CONST&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">dic_capital</span><span class="p">[</span><span class="s1">&#39;HC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">dic_capital</span><span class="p">[</span><span class="s1">&#39;HS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">dic_capital</span><span class="p">[</span><span class="s1">&#39;MANUF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">dic_capital</span><span class="p">[</span><span class="s1">&#39;REST&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">dic_capital</span><span class="p">[</span><span class="s1">&#39;RETAIL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">17</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">dic_capital</span><span class="p">[</span><span class="s1">&#39;SERV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">19</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">21</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">dic_capital</span><span class="p">[</span><span class="s1">&#39;UTIL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">22</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

<span class="n">ndf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dic_capital</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span><span class="n">index</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;ACCOM&#39;</span><span class="p">,</span> <span class="s1">&#39;AG&#39;</span><span class="p">,</span> <span class="s1">&#39;CONST&#39;</span><span class="p">,</span> <span class="s1">&#39;HC&#39;</span><span class="p">,</span> <span class="s1">&#39;HS&#39;</span><span class="p">,</span> <span class="s1">&#39;MANUF&#39;</span><span class="p">,</span> <span class="s1">&#39;REST&#39;</span><span class="p">,</span> <span class="s1">&#39;RETAIL&#39;</span><span class="p">,</span> <span class="s1">&#39;SERV&#39;</span><span class="p">,</span> <span class="s1">&#39;UTIL&#39;</span><span class="p">],</span> <span class="n">columns</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;Capital Stock($)&#39;</span><span class="p">])</span>
<span class="n">ndf</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Capital Stock($)&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ndf</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Capital Stock($)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>HS</th>
      <td>317299299.0</td>
    </tr>
    <tr>
      <th>SERV</th>
      <td>94367097.0</td>
    </tr>
    <tr>
      <th>RETAIL</th>
      <td>61880413.0</td>
    </tr>
    <tr>
      <th>REST</th>
      <td>52581186.0</td>
    </tr>
    <tr>
      <th>HC</th>
      <td>41235645.0</td>
    </tr>
    <tr>
      <th>ACCOM</th>
      <td>23184154.0</td>
    </tr>
    <tr>
      <th>CONST</th>
      <td>4724286.0</td>
    </tr>
    <tr>
      <th>MANUF</th>
      <td>840505.0</td>
    </tr>
    <tr>
      <th>AG</th>
      <td>304744.0</td>
    </tr>
    <tr>
      <th>UTIL</th>
      <td>77125.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><a id='2'></a></p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="hazards-and-damages">
<h2>2) Hazards and Damages<a class="headerlink" href="#hazards-and-damages" title="Permalink to this headline">¶</a></h2>
<p><img alt="title" src="../../_images/Flowchart_2.png" /><br></p>
<p><a id='2a'></a></p>
<div class="section" id="a-hazard-models">
<h3>2a) Hazard Models<a class="headerlink" href="#a-hazard-models" title="Permalink to this headline">¶</a></h3>
<p>The Seaside testbed uses hazard layers that were developed outside of IN-CORE. The hazard layers are the result of a Probabilistic Seismic and Tsunami Hazard Analysis (PSTHA; Park <em>et al.,</em> 2017b). The hazard layers and GUID’s are in the table below</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Recurrence Interval</p></th>
<th class="head"><p>Earthquake</p></th>
<th class="head"><p>Tsunami</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>100-yr</p></td>
<td><p>5dfa4058b9219c934b64d495</p></td>
<td><p>5bc9e25ef7b08533c7e610dc</p></td>
</tr>
<tr class="row-odd"><td><p>250-yr</p></td>
<td><p>5dfa41aab9219c934b64d4b2</p></td>
<td><p>5df910abb9219cd00cf5f0a5</p></td>
</tr>
<tr class="row-even"><td><p>500-yr</p></td>
<td><p>5dfa4300b9219c934b64d4d0</p></td>
<td><p>5df90e07b9219cd00ce971e7</p></td>
</tr>
<tr class="row-odd"><td><p>1,000-yr</p></td>
<td><p>5dfa3e36b9219c934b64c231</p></td>
<td><p>5df90137b9219cd00cb774ec</p></td>
</tr>
<tr class="row-even"><td><p>2,500-yr</p></td>
<td><p>5dfa4417b9219c934b64d4d3</p></td>
<td><p>5df90761b9219cd00ccff258</p></td>
</tr>
<tr class="row-odd"><td><p>5,000-yr</p></td>
<td><p>5dfbca0cb9219c101fd8a58d</p></td>
<td><p>5df90871b9219cd00ccff273</p></td>
</tr>
<tr class="row-even"><td><p>10,000-yr</p></td>
<td><p>5dfa51bfb9219c934b68e6c2</p></td>
<td><p>5d27b986b9219c3c55ad37d0</p></td>
</tr>
</tbody>
</table>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eq_hazard_dict</span> <span class="o">=</span> <span class="p">{</span><span class="mi">100</span><span class="p">:</span> <span class="s2">&quot;5dfa4058b9219c934b64d495&quot;</span><span class="p">,</span> 
                  <span class="mi">250</span><span class="p">:</span> <span class="s2">&quot;5dfa41aab9219c934b64d4b2&quot;</span><span class="p">,</span>
                  <span class="mi">500</span><span class="p">:</span> <span class="s2">&quot;5dfa4300b9219c934b64d4d0&quot;</span><span class="p">,</span>
                  <span class="mi">1000</span><span class="p">:</span> <span class="s2">&quot;5dfa3e36b9219c934b64c231&quot;</span><span class="p">,</span>
                  <span class="mi">2500</span><span class="p">:</span> <span class="s2">&quot;5dfa4417b9219c934b64d4d3&quot;</span><span class="p">,</span> 
                  <span class="mi">5000</span><span class="p">:</span> <span class="s2">&quot;5dfbca0cb9219c101fd8a58d&quot;</span><span class="p">,</span>
                 <span class="mi">10000</span><span class="p">:</span> <span class="s2">&quot;5dfa51bfb9219c934b68e6c2&quot;</span><span class="p">}</span>

<span class="n">tsu_hazard_dict</span> <span class="o">=</span> <span class="p">{</span><span class="mi">100</span><span class="p">:</span> <span class="s2">&quot;5bc9e25ef7b08533c7e610dc&quot;</span><span class="p">,</span> 
                  <span class="mi">250</span><span class="p">:</span> <span class="s2">&quot;5df910abb9219cd00cf5f0a5&quot;</span><span class="p">,</span>
                  <span class="mi">500</span><span class="p">:</span> <span class="s2">&quot;5df90e07b9219cd00ce971e7&quot;</span><span class="p">,</span>
                  <span class="mi">1000</span><span class="p">:</span> <span class="s2">&quot;5df90137b9219cd00cb774ec&quot;</span><span class="p">,</span>
                  <span class="mi">2500</span><span class="p">:</span> <span class="s2">&quot;5df90761b9219cd00ccff258&quot;</span><span class="p">,</span>
                  <span class="mi">5000</span><span class="p">:</span> <span class="s2">&quot;5df90871b9219cd00ccff273&quot;</span><span class="p">,</span>
                  <span class="mi">10000</span><span class="p">:</span> <span class="s2">&quot;5d27b986b9219c3c55ad37d0&quot;</span><span class="p">}</span>

<span class="n">eq_demand</span> <span class="o">=</span> <span class="s1">&#39;pga&#39;</span>
<span class="n">tsu_demand</span> <span class="o">=</span> <span class="s1">&#39;Vmax&#39;</span>

<span class="n">eq_json</span> <span class="o">=</span> <span class="n">hazard_service</span><span class="o">.</span><span class="n">get_earthquake_hazard_metadata</span><span class="p">(</span><span class="n">hazard_id</span><span class="o">=</span><span class="n">eq_hazard_dict</span><span class="p">[</span><span class="n">ret_prd</span><span class="p">])</span>
<span class="n">tsu_json</span> <span class="o">=</span> <span class="n">hazard_service</span><span class="o">.</span><span class="n">get_tsunami_hazard_metadata</span><span class="p">(</span><span class="n">hazard_id</span><span class="o">=</span><span class="n">tsu_hazard_dict</span><span class="p">[</span><span class="n">ret_prd</span><span class="p">])</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eq_json</span><span class="p">[</span><span class="s1">&#39;hazardDatasets&#39;</span><span class="p">])):</span>
    <span class="k">if</span> <span class="n">eq_json</span><span class="p">[</span><span class="s1">&#39;hazardDatasets&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;demandType&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">eq_demand</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">eq_dataset</span> <span class="o">=</span> <span class="n">eq_json</span><span class="p">[</span><span class="s1">&#39;hazardDatasets&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;datasetId&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tsu_json</span><span class="p">[</span><span class="s1">&#39;hazardDatasets&#39;</span><span class="p">])):</span>
    <span class="k">if</span> <span class="n">tsu_json</span><span class="p">[</span><span class="s1">&#39;hazardDatasets&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;demandType&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">tsu_demand</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">tsu_dataset</span> <span class="o">=</span> <span class="n">tsu_json</span><span class="p">[</span><span class="s1">&#39;hazardDatasets&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;datasetId&#39;</span><span class="p">]</span>

<span class="c1"># geoviz.plot_raster_dataset(eq_json[&#39;hazardDatasets&#39;][1][&#39;datasetId&#39;], client)</span>
<span class="n">geoviz</span><span class="o">.</span><span class="n">plot_raster_dataset</span><span class="p">(</span><span class="n">tsu_json</span><span class="p">[</span><span class="s1">&#39;hazardDatasets&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;datasetId&#39;</span><span class="p">],</span> <span class="n">client</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<img alt="../../_images/Notebook1_Seaside_32_1.png" src="../../_images/Notebook1_Seaside_32_1.png" />
</div>
</div>
<p><a id='2b'></a></p>
</div>
<div class="section" id="b-damage-models">
<h3>2b) Damage Models<a class="headerlink" href="#b-damage-models" title="Permalink to this headline">¶</a></h3>
<p>Seaside damage models are fragility curves from HAZUS.</p>
<p>The fragility curve mapping ID’s for Seaside are in the table below:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Infrastructure System</p></th>
<th class="head"><p>Hazard</p></th>
<th class="head"><p>Mapping GUID</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Buildings</p></td>
<td><p>Earthquake</p></td>
<td><p>5d2789dbb9219c3c553c7977</p></td>
</tr>
<tr class="row-odd"><td><p>Buildings</p></td>
<td><p>Tsunami</p></td>
<td><p>5d279bb9b9219c3c553c7fba</p></td>
</tr>
<tr class="row-even"><td><p>Electric Poles</p></td>
<td><p>Earthquake</p></td>
<td><p>6079f6a7ef881f48a4ace306</p></td>
</tr>
<tr class="row-odd"><td><p>Electric Poles</p></td>
<td><p>Tsunami</p></td>
<td><p>6079c5e06799d908861f177c</p></td>
</tr>
<tr class="row-even"><td><p>Roads</p></td>
<td><p>Earthquake</p></td>
<td><p>6079ec1aef881f48a4ac586c</p></td>
</tr>
<tr class="row-odd"><td><p>Roads</p></td>
<td><p>Tsunami</p></td>
<td><p>6079c3bc6799d908861f16d4</p></td>
</tr>
<tr class="row-even"><td><p>Bridges</p></td>
<td><p>Earthquake</p></td>
<td><p>6079f5435b609c56229bf85c</p></td>
</tr>
<tr class="row-odd"><td><p>Bridges</p></td>
<td><p>Tsunami</p></td>
<td><p>6079c41a6799d908861f16fe</p></td>
</tr>
<tr class="row-even"><td><p>Water Facilities</p></td>
<td><p>Earthquake</p></td>
<td><p>5d39e010b9219cc18bd0b0b6</p></td>
</tr>
<tr class="row-odd"><td><p>Water Facilities</p></td>
<td><p>Tsunami</p></td>
<td><p>5d31f737b9219c6d66398521</p></td>
</tr>
<tr class="row-even"><td><p>Water Pipes</p></td>
<td><p>Earthquake</p></td>
<td><p>5b47c227337d4a38464efea8</p></td>
</tr>
<tr class="row-odd"><td><p>Water Pipes</p></td>
<td><p>Tsunami</p></td>
<td><p>5d320a87b9219c6d66398b45</p></td>
</tr>
</tbody>
</table>
<div class="section" id="plotting-some-example-fragility-curves">
<h4>Plotting some example fragility curves<a class="headerlink" href="#plotting-some-example-fragility-curves" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot; TODO: issues with plotting some of these mappings. Looks like it </span>
<span class="sd">    needs a &quot;vmax&quot; value, but unsure where &quot;&quot;&quot;</span>

<span class="n">mapping_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;buildings&#39;</span><span class="p">:</span> 
        <span class="p">{</span><span class="s1">&#39;eq&#39;</span><span class="p">:</span> <span class="s1">&#39;5d2789dbb9219c3c553c7977&#39;</span><span class="p">,</span>
         <span class="s1">&#39;tsu&#39;</span><span class="p">:</span> <span class="s1">&#39;5d279bb9b9219c3c553c7fba&#39;</span><span class="p">},</span>
    
    <span class="s1">&#39;electric_poles&#39;</span><span class="p">:</span> 
        <span class="p">{</span><span class="s1">&#39;eq&#39;</span><span class="p">:</span> <span class="s1">&#39;6079f6a7ef881f48a4ace306&#39;</span><span class="p">,</span>
         <span class="s1">&#39;tsu&#39;</span><span class="p">:</span> <span class="s1">&#39;6079c5e06799d908861f177c&#39;</span><span class="p">},</span> <span class="c1"># doesn&#39;t plot</span>

    <span class="s1">&#39;roads&#39;</span><span class="p">:</span> 
        <span class="p">{</span><span class="s1">&#39;eq&#39;</span><span class="p">:</span> <span class="s1">&#39;6079ec1aef881f48a4ac586c&#39;</span><span class="p">,</span>
        <span class="s1">&#39;tsu&#39;</span><span class="p">:</span> <span class="s1">&#39;6079c3bc6799d908861f16d4&#39;</span><span class="p">},</span>  <span class="c1"># doesn&#39;t plot</span>
    
    <span class="s1">&#39;bridges&#39;</span><span class="p">:</span> 
        <span class="p">{</span><span class="s1">&#39;eq&#39;</span><span class="p">:</span> <span class="s1">&#39;6079f5435b609c56229bf85c&#39;</span><span class="p">,</span>
         <span class="s1">&#39;tsu&#39;</span><span class="p">:</span> <span class="s1">&#39;6079c41a6799d908861f16fe&#39;</span><span class="p">},</span>  <span class="c1"># doesn&#39;t plot</span>
    
    <span class="s1">&#39;water_pipe&#39;</span><span class="p">:</span> 
        <span class="p">{</span><span class="s1">&#39;eq&#39;</span><span class="p">:</span> <span class="s1">&#39;5b47c227337d4a38464efea8&#39;</span><span class="p">,</span>
         <span class="s1">&#39;tsu&#39;</span><span class="p">:</span> <span class="s1">&#39;5d320a87b9219c6d66398b45&#39;</span><span class="p">},</span>
    
    <span class="s1">&#39;water_facility&#39;</span><span class="p">:</span> 
        <span class="p">{</span><span class="s1">&#39;eq&#39;</span><span class="p">:</span> <span class="s1">&#39;6079f7825b609c56229bf976&#39;</span><span class="p">,</span>
         <span class="s1">&#39;tsu&#39;</span><span class="p">:</span> <span class="s1">&#39;6079b8a66799d908861e4bf0&#39;</span><span class="p">},</span>  <span class="c1"># doesn&#39;t plot</span>
<span class="p">}</span>


<span class="n">mapping_id</span> <span class="o">=</span> <span class="n">mapping_dict</span><span class="p">[</span><span class="s1">&#39;buildings&#39;</span><span class="p">][</span><span class="s1">&#39;eq&#39;</span><span class="p">]</span>

<span class="n">mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">fragility_services</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">mapping_id</span><span class="p">))</span>

<span class="c1"># plot fragility for the first 3 archetypes using pyincore viz method</span>
<span class="k">for</span> <span class="n">mapping</span> <span class="ow">in</span> <span class="n">mapping_set</span><span class="o">.</span><span class="n">mappings</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
    <span class="n">fragility_id</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">entry</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">mapping</span><span class="o">.</span><span class="n">entry</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">fragility_set</span> <span class="o">=</span> <span class="n">FragilityCurveSet</span><span class="p">(</span><span class="n">fragility_services</span><span class="o">.</span><span class="n">get_dfr3_set</span><span class="p">(</span><span class="n">fragility_id</span><span class="p">))</span>
    <span class="n">plt</span> <span class="o">=</span> <span class="n">plotviz</span><span class="o">.</span><span class="n">get_fragility_plot</span><span class="p">(</span><span class="n">fragility_set</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Notebook1_Seaside_35_0.png" src="../../_images/Notebook1_Seaside_35_0.png" />
<img alt="../../_images/Notebook1_Seaside_35_1.png" src="../../_images/Notebook1_Seaside_35_1.png" />
<img alt="../../_images/Notebook1_Seaside_35_2.png" src="../../_images/Notebook1_Seaside_35_2.png" />
</div>
</div>
</div>
<div class="section" id="setting-up-a-function-to-read-monte-carlo-results">
<h4>Setting up a function to read Monte-Carlo results.<a class="headerlink" href="#setting-up-a-function-to-read-monte-carlo-results" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_MC_results</span><span class="p">(</span><span class="n">path_to_mc</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Reads the building monte carlo results into a pandas dataframe.</span>
<span class="sd">        The output data from this analysis needs to be reformatted to be read by &quot;read_csv&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">replace_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;DS_0&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s1">&#39;DS_1&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="s1">&#39;DS_2&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="s1">&#39;DS_3&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                    <span class="s1">&#39;DS_4&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_to_mc</span><span class="p">)</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_sims</span><span class="p">)]</span>
    <span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;sample_damage_states&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>    
    <span class="k">del</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;sample_damage_states&#39;</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">replace_dict</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="setting-up-an-alternative-plotting-function-to-plot-buildings-spatially">
<h4>Setting up an alternative plotting function to plot buildings spatially.<a class="headerlink" href="#setting-up-an-alternative-plotting-function-to-plot-buildings-spatially" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="k">def</span> <span class="nf">plot_gdf_map</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">basemap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">OpenStreetMap</span><span class="o">.</span><span class="n">Mapnik</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Taken from pyincore-viz. </span>
<span class="sd">    Not using the pyincore-viz version b/c it&#39;s limited on plotting options</span>
<span class="sd">        - Added **kwargs for more control over the geopandas plotting function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span> <span class="c1"># adding a colorbar to side</span>
        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> 
                      <span class="n">column</span><span class="o">=</span><span class="n">column</span><span class="p">,</span>
                      <span class="n">categorical</span><span class="o">=</span><span class="n">category</span><span class="p">,</span> 
                      <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                      <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span>
                     <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">category</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> 
                      <span class="n">column</span><span class="o">=</span><span class="n">column</span><span class="p">,</span>
                      <span class="n">categorical</span><span class="o">=</span><span class="n">category</span><span class="p">,</span> 
                      <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                     <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        
    <span class="k">if</span> <span class="n">basemap</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="setting-up-a-quick-way-to-read-pyincore-datasets-into-either-dataframes-or-geodataframes">
<h4>Setting up a quick way to read pyIncore datasets into either dataframes or geodataframes.<a class="headerlink" href="#setting-up-a-quick-way-to-read-pyincore-datasets-into-either-dataframes-or-geodataframes" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_pyincore_df</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">ds_id</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; reading pyincore dataset and loading into dataframe</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_data_service</span><span class="p">(</span><span class="n">ds_id</span><span class="p">,</span> <span class="n">data_service</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">index</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">read_pyincore_gdf</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">ds_id</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; reading pyincore dataset and loading into a geodataframe</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_data_service</span><span class="p">(</span><span class="n">ds_id</span><span class="p">,</span> <span class="n">data_service</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_dataframe_from_shapefile</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">index</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<p><a id='2c'></a></p>
</div>
</div>
<div class="section" id="c-damage-to-physical-infrastructure">
<h3>2c) Damage to Physical Infrastructure<a class="headerlink" href="#c-damage-to-physical-infrastructure" title="Permalink to this headline">¶</a></h3>
<div class="section" id="building-damage">
<h4>Building Damage<a class="headerlink" href="#building-damage" title="Permalink to this headline">¶</a></h4>
<p>Running building damage for earthquake, tsunami, and cumulative earthquake+tsunami.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Earthquake</span>
<span class="c1"># initializing building damage and fragility service</span>
<span class="n">bldg_dmg</span> <span class="o">=</span> <span class="n">BuildingDamage</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>   
<span class="n">fragility_service</span> <span class="o">=</span> <span class="n">FragilityService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="c1"># defining building dataset (GIS point layer)</span>
<span class="n">bldg_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;613ba5ef5d3b1d6461e8c415&quot;</span>
<span class="n">bldg_dmg</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;buildings&quot;</span><span class="p">,</span> <span class="n">bldg_dataset_id</span><span class="p">)</span>

<span class="c1"># specifiying mapping id from fragilites to building types</span>
<span class="n">mapping_id</span> <span class="o">=</span> <span class="s2">&quot;5d2789dbb9219c3c553c7977&quot;</span> <span class="c1"># 4 DS</span>
<span class="n">mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">fragility_service</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">mapping_id</span><span class="p">))</span>
<span class="n">bldg_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s1">&#39;dfr3_mapping_set&#39;</span><span class="p">,</span> <span class="n">mapping_set</span><span class="p">)</span>

<span class="n">bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_type&quot;</span><span class="p">,</span> <span class="s2">&quot;earthquake&quot;</span><span class="p">)</span>
<span class="n">bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">result_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;buildings_eq_</span><span class="si">{}</span><span class="s1">yr&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">hazard_id</span> <span class="o">=</span> <span class="n">eq_hazard_dict</span><span class="p">[</span><span class="n">ret_prd</span><span class="p">]</span>
<span class="n">bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_id&quot;</span><span class="p">,</span> <span class="n">hazard_id</span><span class="p">)</span>
<span class="n">bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">result_name</span><span class="p">)</span>

<span class="n">bldg_dmg</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Earthquake done.&#39;</span><span class="p">)</span>



<span class="c1"># --- Tsunami</span>
<span class="c1"># initializing pyincore building damage and fragility service </span>
<span class="n">bldg_dmg</span> <span class="o">=</span> <span class="n">BuildingDamage</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">fragility_service</span> <span class="o">=</span> <span class="n">FragilityService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="c1"># defining building dataset (GIS point layer)</span>
<span class="n">bldg_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;613ba5ef5d3b1d6461e8c415&quot;</span>
<span class="n">bldg_dmg</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;buildings&quot;</span><span class="p">,</span> <span class="n">bldg_dataset_id</span><span class="p">)</span>

<span class="c1"># specifiying mapping id from fragilites to building types</span>
<span class="n">mapping_id</span> <span class="o">=</span> <span class="s2">&quot;5d279bb9b9219c3c553c7fba&quot;</span> <span class="c1"># 4 DS</span>
<span class="n">mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">fragility_service</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">mapping_id</span><span class="p">))</span>
<span class="n">bldg_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s1">&#39;dfr3_mapping_set&#39;</span><span class="p">,</span> <span class="n">mapping_set</span><span class="p">)</span>

<span class="n">bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_type&quot;</span><span class="p">,</span> <span class="s2">&quot;tsunami&quot;</span><span class="p">)</span>
<span class="n">bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">result_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;buildings_tsu_</span><span class="si">{}</span><span class="s1">yr&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">hazard_id</span> <span class="o">=</span> <span class="n">tsu_hazard_dict</span><span class="p">[</span><span class="n">ret_prd</span><span class="p">]</span>
<span class="n">bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_id&quot;</span><span class="p">,</span> <span class="n">hazard_id</span><span class="p">)</span>
<span class="n">bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">result_name</span><span class="p">)</span>

<span class="n">bldg_dmg</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Tsunami done.&#39;</span><span class="p">)</span>




<span class="c1"># --- Cumulative</span>
<span class="c1"># initializing pyIncore cumulative building damage</span>
<span class="n">cumulative_bldg_dmg</span> <span class="o">=</span> <span class="n">CumulativeBuildingDamage</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">cumulative_bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="c1"># reading in damage results from above analysis</span>
<span class="n">eq_damage_results_csv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;buildings_eq_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">tsu_damage_results_csv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;buildings_tsu_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>

<span class="c1"># loading datasets from CSV files into pyincore</span>
<span class="n">eq_damage_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">eq_damage_results_csv</span><span class="p">,</span> <span class="s2">&quot;ergo:buildingDamageVer5&quot;</span><span class="p">)</span>
<span class="n">tsu_damage_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">tsu_damage_results_csv</span><span class="p">,</span> <span class="s2">&quot;ergo:buildingDamageVer5&quot;</span><span class="p">)</span>

<span class="n">cumulative_bldg_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;eq_bldg_dmg&quot;</span><span class="p">,</span> <span class="n">eq_damage_dataset</span><span class="p">)</span>
<span class="n">cumulative_bldg_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;tsunami_bldg_dmg&quot;</span><span class="p">,</span> <span class="n">tsu_damage_dataset</span><span class="p">)</span>

<span class="c1"># defining path to output </span>
<span class="n">result_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;buildings_cumulative_</span><span class="si">{}</span><span class="s1">yr&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">cumulative_bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">result_name</span><span class="p">)</span>

<span class="c1"># running analysis</span>
<span class="n">cumulative_bldg_dmg</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cumulative done.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Earthquake done.
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Tsunami done.
Cumulative done.
</pre></div>
</div>
</div>
</div>
<p>Building MC Sampling</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">building_dmg_result</span> <span class="o">=</span> <span class="n">cumulative_bldg_dmg</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s1">&#39;combined-result&#39;</span><span class="p">)</span>

<span class="n">path_to_mc_results</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_buildings_cumulative_</span><span class="si">{}</span><span class="s1">yr&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>

<span class="n">mc_bldg</span> <span class="o">=</span> <span class="n">MonteCarloFailureProbability</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">mc_bldg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;damage&quot;</span><span class="p">,</span> <span class="n">building_dmg_result</span><span class="p">)</span>
<span class="n">mc_bldg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mc_bldg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_samples&quot;</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">)</span>
<span class="n">mc_bldg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;damage_interval_keys&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DS_0&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_1&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_2&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_3&quot;</span><span class="p">])</span>
<span class="n">mc_bldg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;failure_state_keys&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DS_1&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_2&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_3&quot;</span><span class="p">])</span>

<span class="n">mc_bldg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">path_to_mc_results</span><span class="p">)</span> <span class="c1"># name of csv file with results</span>
<span class="n">mc_bldg</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p><strong>Explore Monte-Carlo Building Damage Results</strong></p>
<p>Each row is a parcel, each column is a sample from the Monte-Carlo analysis.</p>
<ul class="simple">
<li><p>0: No/Insignificant Damage</p></li>
<li><p>1: Moderate Damage</p></li>
<li><p>2: Heavy Damage</p></li>
<li><p>3: Complete Damage</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path_to_df</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_buildings_cumulative_</span><span class="si">{}</span><span class="s1">yr_sample_damage_states.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">mc_df</span> <span class="o">=</span> <span class="n">read_MC_results</span><span class="p">(</span><span class="n">path_to_df</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">)</span>
<span class="n">mc_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
    <tr>
      <th>guid</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>fba4c73f-9b1b-4942-b7fb-bc276a4e0a4e</th>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>65d6e370-c05b-4b2f-bd17-d914d1d056c7</th>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>dad76485-9694-409e-ac7f-c64c7bd5c32c</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>3</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6f57cfb6-d244-40d5-96f5-03aeddd5e30a</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>929f1040-6224-409d-b4e3-58946daf3b91</th>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mc_df</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mc_df</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># getting average of MC results</span>

<span class="c1"># reading pyIncore dataset to geodataframe</span>
<span class="n">bldg_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;613ba5ef5d3b1d6461e8c415&quot;</span>        <span class="c1"># defining building dataset (GIS point layer)</span>
<span class="n">bldg_gdf</span> <span class="o">=</span> <span class="n">read_pyincore_gdf</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">bldg_dataset_id</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;guid&#39;</span><span class="p">)</span>

<span class="c1"># merging the two above</span>
<span class="n">bldg_mc_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">bldg_gdf</span><span class="p">,</span> <span class="n">mc_df</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">],</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># plotting results</span>
<span class="n">plot_gdf_map</span><span class="p">(</span><span class="n">bldg_mc_df</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;avg&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;magma&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<img alt="../../_images/Notebook1_Seaside_49_1.png" src="../../_images/Notebook1_Seaside_49_1.png" />
</div>
</div>
</div>
<div class="section" id="electric-damage">
<h4>Electric Damage<a class="headerlink" href="#electric-damage" title="Permalink to this headline">¶</a></h4>
<p>Running electric power network damage for earthquake, tsunami, and cumulative earthquake+tsunami.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Earthquake </span>
<span class="c1"># initializing epf damage and fragility service</span>
<span class="n">epf_dmg</span> <span class="o">=</span> <span class="n">EpfDamage</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">fragility_service</span> <span class="o">=</span> <span class="n">FragilityService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="c1"># defining electric pole dataset (GIS point layer)</span>
<span class="n">poles_ss_id</span> <span class="o">=</span> <span class="s2">&quot;5d263f08b9219cf93c056c68&quot;</span>     <span class="c1"># elelctric power poles and substation</span>
<span class="n">epf_dmg</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;epfs&quot;</span><span class="p">,</span> <span class="n">poles_ss_id</span><span class="p">)</span>

<span class="c1"># Fragility Mapping on incore-service</span>
<span class="n">mapping_id</span> <span class="o">=</span> <span class="s2">&quot;5d489aa1b9219c0689f1988e&quot;</span> <span class="c1"># 5 DS</span>
<span class="c1"># mapping_id = &quot;6079f6a7ef881f48a4ace306&quot; # 4 DS</span>
<span class="n">mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">fragility_service</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">mapping_id</span><span class="p">))</span>
<span class="n">epf_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s1">&#39;dfr3_mapping_set&#39;</span><span class="p">,</span> <span class="n">mapping_set</span><span class="p">)</span>

<span class="n">epf_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_type&quot;</span><span class="p">,</span> <span class="s1">&#39;earthquake&#39;</span><span class="p">)</span>
<span class="n">epf_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">epf_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s1">&#39;fragility_key&#39;</span><span class="p">,</span> <span class="s2">&quot;pga&quot;</span><span class="p">)</span>

<span class="n">result_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;electric_eq_</span><span class="si">{}</span><span class="s1">yr&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">hazard_id</span> <span class="o">=</span> <span class="n">eq_hazard_dict</span><span class="p">[</span><span class="n">ret_prd</span><span class="p">]</span>

<span class="n">epf_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_id&quot;</span><span class="p">,</span> <span class="n">hazard_id</span><span class="p">)</span>
<span class="n">epf_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">result_name</span><span class="p">)</span>

<span class="c1"># Run Analysis</span>
<span class="n">epf_dmg</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Earthquake done.&#39;</span><span class="p">)</span>


<span class="c1"># --- Tsunami</span>
<span class="c1"># Initializing EPF damage and fragility service</span>
<span class="n">epf_dmg</span> <span class="o">=</span> <span class="n">EpfDamage</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">fragility_service</span> <span class="o">=</span> <span class="n">FragilityService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="c1"># defining electric poles and substation dataset (GIS point layer)</span>
<span class="n">poles_ss_id</span> <span class="o">=</span> <span class="s2">&quot;5d263f08b9219cf93c056c68&quot;</span>
<span class="n">epf_dmg</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;epfs&quot;</span><span class="p">,</span> <span class="n">poles_ss_id</span><span class="p">)</span>

<span class="c1"># Fragility Mapping on incore-service</span>
<span class="n">mapping_id</span> <span class="o">=</span> <span class="s2">&quot;5d31eb7fb9219c6d66398445&quot;</span> <span class="c1"># 5 DS</span>
<span class="c1"># mapping_id = &quot;6079c5e06799d908861f177c&quot; # 4 DS</span>
<span class="n">mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">fragility_service</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">mapping_id</span><span class="p">))</span>
<span class="n">epf_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s1">&#39;dfr3_mapping_set&#39;</span><span class="p">,</span> <span class="n">mapping_set</span><span class="p">)</span>

<span class="n">epf_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_type&quot;</span><span class="p">,</span> <span class="s2">&quot;tsunami&quot;</span><span class="p">)</span>
<span class="n">epf_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">epf_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s1">&#39;fragility_key&#39;</span><span class="p">,</span> <span class="s2">&quot;Non-Retrofit inundationDepth Fragility ID Code&quot;</span><span class="p">)</span>

<span class="n">result_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;electric_tsu_</span><span class="si">{}</span><span class="s1">yr&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">hazard_id</span> <span class="o">=</span> <span class="n">tsu_hazard_dict</span><span class="p">[</span><span class="n">ret_prd</span><span class="p">]</span>

<span class="n">epf_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_id&quot;</span><span class="p">,</span> <span class="n">hazard_id</span><span class="p">)</span>
<span class="n">epf_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">result_name</span><span class="p">)</span>

<span class="c1"># Run Analysis</span>
<span class="n">epf_dmg</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Tsunami done.&#39;</span><span class="p">)</span>


<span class="c1"># --- Cumulative</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Cumulative electric damage does not exist in pyIncore yet. Doing manually.&#39;</span><span class="p">)</span>
<span class="n">path_to_eq</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;electric_eq_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">path_to_ts</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;electric_tsu_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>

<span class="n">eq_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_to_eq</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ts_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_to_ts</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">cumulative</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">eq_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">cumulative</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> \
    <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span>

<span class="n">cumulative</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> \
    <span class="o">+</span> <span class="p">((</span><span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]))</span>

<span class="n">cumulative</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> \
    <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> \
    <span class="o">+</span> <span class="p">((</span><span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]))</span>

<span class="n">cumulative</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]</span> \
    <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]</span> \
    <span class="o">+</span> <span class="p">((</span><span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]))</span>

<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;DS_0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_0&#39;</span><span class="p">]</span>
<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;DS_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_0&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_1&#39;</span><span class="p">]</span>
<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;DS_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_1&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_2&#39;</span><span class="p">]</span>
<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;DS_3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_2&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_3&#39;</span><span class="p">]</span>
<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;DS_4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_3&#39;</span><span class="p">]</span>

<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;hazard&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Earthquake+Tsunami&#39;</span>
<span class="n">path_to_cumulative</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;electric_cumulative_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">cumulative</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_to_cumulative</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Earthquake done.
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Tsunami done.

Cumulative electric damage does not exist in pyIncore yet. Doing manually.
</pre></div>
</div>
</div>
</div>
<p>Electric MC Sampling</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">elec_dmg_result</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">path_to_cumulative</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;incore:epfDamage&#39;</span><span class="p">)</span>
<span class="n">path_to_mc_results</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_electric_cumulative_</span><span class="si">{}</span><span class="s1">yr&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>

<span class="n">mc</span> <span class="o">=</span> <span class="n">MonteCarloFailureProbability</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;damage&quot;</span><span class="p">,</span> <span class="n">elec_dmg_result</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_samples&quot;</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;damage_interval_keys&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DS_0&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_1&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_2&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_3&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_4&quot;</span><span class="p">])</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;failure_state_keys&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DS_1&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_2&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_3&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_4&quot;</span><span class="p">])</span>

<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">path_to_mc_results</span><span class="p">)</span> <span class="c1"># name of csv file with results</span>
<span class="n">mc</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p><strong>Explore Monte-Carlo Electric Damage Results</strong></p>
<p>Each row is an infrastructure component, each column is a sample from the Monte-Carlo analysis.</p>
<ul class="simple">
<li><p>0: No/Insignificant Damage</p></li>
<li><p>1: Moderate Damage</p></li>
<li><p>2: Heavy Damage</p></li>
<li><p>3: Complete Damage</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path_to_df</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_electric_cumulative_</span><span class="si">{}</span><span class="s1">yr_sample_damage_states.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">mc_df</span> <span class="o">=</span> <span class="n">read_MC_results</span><span class="p">(</span><span class="n">path_to_df</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">)</span>
<span class="n">mc_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
    <tr>
      <th>guid</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>c34c4207-d1e8-47d1-b29e-1ba11d951bce</th>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>2</td>
      <td>3</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>1</td>
    </tr>
    <tr>
      <th>402388b9-f14c-4402-9ad9-8b0965de0937</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1d244334-1aef-4ced-b5f5-6f886a9d0db6</th>
      <td>3</td>
      <td>3</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>5a051ea9-a0b3-45ee-a283-82512e7b7cb6</th>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>51a54596-597b-46f9-8c8b-bc58f1105853</th>
      <td>3</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mc_df</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mc_df</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># getting average of MC results</span>

<span class="c1"># reading pyIncore dataset to geodataframe</span>
<span class="n">elec_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;5d263f08b9219cf93c056c68&quot;</span>        <span class="c1"># defining building dataset (GIS point layer)</span>
<span class="n">elec_gdf</span> <span class="o">=</span> <span class="n">read_pyincore_gdf</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">elec_dataset_id</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;guid&#39;</span><span class="p">)</span>

<span class="c1"># merging the two above</span>
<span class="n">elec_mc_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">elec_gdf</span><span class="p">,</span> <span class="n">mc_df</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">],</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># plotting results</span>
<span class="n">plot_gdf_map</span><span class="p">(</span><span class="n">elec_mc_df</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;avg&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<img alt="../../_images/Notebook1_Seaside_56_1.png" src="../../_images/Notebook1_Seaside_56_1.png" />
</div>
</div>
</div>
<div class="section" id="transportation-damage">
<h4>Transportation Damage<a class="headerlink" href="#transportation-damage" title="Permalink to this headline">¶</a></h4>
<p>Running road and bridge damage for earthquake, tsunami, and cumulative earthquake+tsunami.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Earthquake</span>
<span class="c1"># Road damage</span>
<span class="c1"># Initializing road damage and fragility service</span>
<span class="n">road_dmg</span> <span class="o">=</span> <span class="n">RoadDamage</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">fragility_service</span> <span class="o">=</span> <span class="n">FragilityService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="c1"># loading in road dataset</span>
<span class="n">road_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;60e5e5cd544e944c3ce37d08&quot;</span>
<span class="n">road_dmg</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;roads&quot;</span><span class="p">,</span> <span class="n">road_dataset_id</span><span class="p">)</span>

<span class="c1"># seaside road fragility mappng for EQ</span>
<span class="n">mapping_id</span> <span class="o">=</span> <span class="s2">&quot;5d545b0bb9219c0689f1f3f4&quot;</span> <span class="c1"># 5 DS</span>
<span class="c1"># mapping_id = &quot;6079ec1aef881f48a4ac586c&quot; # 4 DS</span>
<span class="n">mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">fragility_service</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">mapping_id</span><span class="p">))</span>
<span class="n">road_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s1">&#39;dfr3_mapping_set&#39;</span><span class="p">,</span> <span class="n">mapping_set</span><span class="p">)</span>

<span class="n">road_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_type&quot;</span><span class="p">,</span> <span class="s1">&#39;earthquake&#39;</span><span class="p">)</span>
<span class="n">road_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">road_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;fragility_key&quot;</span><span class="p">,</span> <span class="s1">&#39;pgd&#39;</span><span class="p">)</span>

<span class="n">result_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;road_eq_</span><span class="si">{}</span><span class="s1">yr&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">hazard_id</span> <span class="o">=</span> <span class="n">eq_hazard_dict</span><span class="p">[</span><span class="n">ret_prd</span><span class="p">]</span>

<span class="n">road_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_id&quot;</span><span class="p">,</span> <span class="n">hazard_id</span><span class="p">)</span>
<span class="n">road_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">result_name</span><span class="p">)</span>

<span class="n">road_dmg</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>


<span class="c1"># Bridge damage</span>
<span class="c1"># initializing bridge damage and fragility service</span>
<span class="n">brdg_dmg</span> <span class="o">=</span> <span class="n">BridgeDamage</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">fragility_service</span> <span class="o">=</span> <span class="n">FragilityService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="c1"># Seaside bridges</span>
<span class="n">bridge_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;60e5e576d3c92a78c893ff69&quot;</span>
<span class="n">brdg_dmg</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;bridges&quot;</span><span class="p">,</span> <span class="n">bridge_dataset_id</span><span class="p">)</span>

<span class="c1"># Set analysis parameters</span>

<span class="c1"># seaside road fragility mappng for EQ</span>
<span class="n">mapping_id</span> <span class="o">=</span> <span class="s2">&quot;5d55c3a1b9219c0689f1f898&quot;</span> <span class="c1"># 5 DS</span>
<span class="c1"># mapping_id = &quot;6079f5435b609c56229bf85c&quot; # 4 DS</span>
<span class="n">mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">fragility_service</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">mapping_id</span><span class="p">))</span>
<span class="n">brdg_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s1">&#39;dfr3_mapping_set&#39;</span><span class="p">,</span> <span class="n">mapping_set</span><span class="p">)</span>

<span class="n">brdg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_type&quot;</span><span class="p">,</span> <span class="s1">&#39;earthquake&#39;</span><span class="p">)</span>
<span class="n">brdg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">result_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;bridge_eq_</span><span class="si">{}</span><span class="s1">yr&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">hazard_id</span> <span class="o">=</span> <span class="n">eq_hazard_dict</span><span class="p">[</span><span class="n">ret_prd</span><span class="p">]</span>
<span class="n">brdg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_id&quot;</span><span class="p">,</span> <span class="n">hazard_id</span><span class="p">)</span>
<span class="n">brdg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">result_name</span><span class="p">)</span>

<span class="n">brdg_dmg</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Earthquake done.&#39;</span><span class="p">)</span>








<span class="c1"># --- Tsunami</span>
<span class="c1"># Road damage</span>
<span class="c1"># Initializing road damage and fragility service</span>
<span class="n">road_dmg</span> <span class="o">=</span> <span class="n">RoadDamage</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">fragility_service</span> <span class="o">=</span> <span class="n">FragilityService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="c1"># loading road dataset</span>
<span class="n">road_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;60e5e5cd544e944c3ce37d08&quot;</span>
<span class="n">road_dmg</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;roads&quot;</span><span class="p">,</span> <span class="n">road_dataset_id</span><span class="p">)</span>

<span class="c1"># seaside road fragility mappng for tsunami</span>
<span class="n">mapping_id</span> <span class="o">=</span> <span class="s2">&quot;5d274fd8b9219c3c553c71ff&quot;</span> <span class="c1"># 5 DS</span>
<span class="c1"># mapping_id = &quot;6079c3bc6799d908861f16d4&quot; # 4 DS</span>
<span class="n">mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">fragility_service</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">mapping_id</span><span class="p">))</span>
<span class="n">road_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s1">&#39;dfr3_mapping_set&#39;</span><span class="p">,</span> <span class="n">mapping_set</span><span class="p">)</span>

<span class="n">road_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_type&quot;</span><span class="p">,</span> <span class="s1">&#39;tsunami&#39;</span><span class="p">)</span>
<span class="n">road_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">road_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;fragility_key&quot;</span><span class="p">,</span> <span class="s2">&quot;Non-Retrofit inundationDepth Fragility ID Code&quot;</span><span class="p">)</span>


<span class="n">result_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;road_tsu_</span><span class="si">{}</span><span class="s1">yr&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">hazard_id</span> <span class="o">=</span> <span class="n">tsu_hazard_dict</span><span class="p">[</span><span class="n">ret_prd</span><span class="p">]</span>

<span class="n">road_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_id&quot;</span><span class="p">,</span> <span class="n">hazard_id</span><span class="p">)</span>
<span class="n">road_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">result_name</span><span class="p">)</span>

<span class="n">road_dmg</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>




<span class="c1"># Bridge damage</span>

<span class="c1"># Initialzing bridge damage and fragility service</span>
<span class="n">brdg_dmg</span> <span class="o">=</span> <span class="n">BridgeDamage</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">fragility_service</span> <span class="o">=</span> <span class="n">FragilityService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="c1"># Seaside bridges</span>
<span class="n">bridge_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;60e5e576d3c92a78c893ff69&quot;</span>
<span class="n">brdg_dmg</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;bridges&quot;</span><span class="p">,</span> <span class="n">bridge_dataset_id</span><span class="p">)</span>

<span class="c1"># seaside road fragility mappng for EQ</span>
<span class="n">mapping_id</span> <span class="o">=</span> <span class="s2">&quot;5d275000b9219c3c553c7202&quot;</span>	<span class="c1"># 5 DS</span>
<span class="c1"># mapping_id = &quot;6079c41a6799d908861f16fe&quot; # 4 DS</span>
<span class="n">mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">fragility_service</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">mapping_id</span><span class="p">))</span>
<span class="n">brdg_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s1">&#39;dfr3_mapping_set&#39;</span><span class="p">,</span> <span class="n">mapping_set</span><span class="p">)</span>

<span class="n">brdg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_type&quot;</span><span class="p">,</span> <span class="s1">&#39;tsunami&#39;</span><span class="p">)</span>

<span class="n">result_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;bridge_tsu_</span><span class="si">{}</span><span class="s1">yr&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">hazard_id</span> <span class="o">=</span> <span class="n">tsu_hazard_dict</span><span class="p">[</span><span class="n">ret_prd</span><span class="p">]</span>
<span class="n">brdg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_id&quot;</span><span class="p">,</span> <span class="n">hazard_id</span><span class="p">)</span>
<span class="n">brdg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">result_name</span><span class="p">)</span>

<span class="n">brdg_dmg</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Tsunami done.&#39;</span><span class="p">)</span>


<span class="c1"># --- Cumualtive</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Cumulative transportation damage does not exist in pyIncore yet. Doing manually&#39;</span><span class="p">)</span>

<span class="c1"># Road Damage</span>

<span class="n">path_to_eq</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;road_eq_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">path_to_ts</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;road_tsu_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>

<span class="n">eq_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_to_eq</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ts_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_to_ts</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">cumulative</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">eq_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">cumulative</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> \
    <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span>

<span class="n">cumulative</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> \
    <span class="o">+</span> <span class="p">((</span><span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]))</span>

<span class="n">cumulative</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> \
    <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> \
    <span class="o">+</span> <span class="p">((</span><span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]))</span>

<span class="n">cumulative</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]</span> \
    <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]</span> \
    <span class="o">+</span> <span class="p">((</span><span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]))</span>

<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;DS_0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_0&#39;</span><span class="p">]</span>
<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;DS_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_0&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_1&#39;</span><span class="p">]</span>
<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;DS_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_1&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_2&#39;</span><span class="p">]</span>
<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;DS_3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_2&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_3&#39;</span><span class="p">]</span>
<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;DS_4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_3&#39;</span><span class="p">]</span>

<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;hazard&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Earthquake+Tsunami&#39;</span>
<span class="n">path_to_cumulative</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;road_cumulative_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">cumulative</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_to_cumulative</span><span class="p">)</span>


<span class="c1"># Bridge Damage</span>

<span class="n">path_to_eq</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;bridge_eq_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">path_to_ts</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;bridge_tsu_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>

<span class="n">eq_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_to_eq</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ts_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_to_ts</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">cumulative</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">eq_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">cumulative</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> \
    <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span>

<span class="n">cumulative</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> \
    <span class="o">+</span> <span class="p">((</span><span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]))</span>

<span class="n">cumulative</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> \
    <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> \
    <span class="o">+</span> <span class="p">((</span><span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]))</span>

<span class="n">cumulative</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]</span> \
    <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]</span> \
    <span class="o">+</span> <span class="p">((</span><span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]))</span>

<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;DS_0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_0&#39;</span><span class="p">]</span>
<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;DS_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_0&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_1&#39;</span><span class="p">]</span>
<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;DS_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_1&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_2&#39;</span><span class="p">]</span>
<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;DS_3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_2&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_3&#39;</span><span class="p">]</span>
<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;DS_4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_3&#39;</span><span class="p">]</span>

<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;hazard&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Earthquake+Tsunami&#39;</span>
<span class="n">path_to_cumulative</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;bridge_cumulative_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">cumulative</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_to_cumulative</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Earthquake done.
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Tsunami done.

Cumulative transportation damage does not exist in pyIncore yet. Doing manually
</pre></div>
</div>
</div>
</div>
<p>Transportation MC Sampling</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Road</span>
<span class="n">path_to_cumulative</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;road_cumulative_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">road_dmg_result</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">path_to_cumulative</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;ergo:roadDamageVer3&#39;</span><span class="p">)</span>
<span class="n">path_to_mc_results</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_road_cumulative_</span><span class="si">{}</span><span class="s1">yr&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>

<span class="n">mc</span> <span class="o">=</span> <span class="n">MonteCarloFailureProbability</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;damage&quot;</span><span class="p">,</span> <span class="n">road_dmg_result</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_samples&quot;</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;damage_interval_keys&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DS_0&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_1&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_2&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_3&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_4&quot;</span><span class="p">])</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;failure_state_keys&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DS_1&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_2&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_3&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_4&quot;</span><span class="p">])</span>

<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">path_to_mc_results</span><span class="p">)</span> <span class="c1"># name of csv file with results</span>
<span class="n">mc</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="n">path_to_df</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_road_cumulative_</span><span class="si">{}</span><span class="s1">yr_sample_damage_states.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">read_MC_results</span><span class="p">(</span><span class="n">path_to_df</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">)</span>
<span class="n">df</span>



<span class="c1"># Bridge</span>
<span class="n">path_to_cumulative</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;bridge_cumulative_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">brdg_dmg_result</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">path_to_cumulative</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;ergo:bridgeDamageVer3&#39;</span><span class="p">)</span>
<span class="n">path_to_mc_results</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_bridge_cumulative_</span><span class="si">{}</span><span class="s1">yr&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>

<span class="n">mc</span> <span class="o">=</span> <span class="n">MonteCarloFailureProbability</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;damage&quot;</span><span class="p">,</span> <span class="n">brdg_dmg_result</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_samples&quot;</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;damage_interval_keys&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DS_0&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_1&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_2&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_3&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_4&quot;</span><span class="p">])</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;failure_state_keys&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DS_1&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_2&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_3&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_4&quot;</span><span class="p">])</span>

<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">path_to_mc_results</span><span class="p">)</span> <span class="c1"># name of csv file with results</span>
<span class="n">mc</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p><strong>Explore Monte-Carlo Transportation Damage Results</strong></p>
<p>Only showing road damage results. Each row is a road component, each column is a sample from the Monte-Carlo analysis.</p>
<ul class="simple">
<li><p>0: No/Insignificant Damage</p></li>
<li><p>1: Moderate Damage</p></li>
<li><p>2: Heavy Damage</p></li>
<li><p>3: Complete Damage</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path_to_df</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_road_cumulative_</span><span class="si">{}</span><span class="s1">yr_sample_damage_states.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">mc_df</span> <span class="o">=</span> <span class="n">read_MC_results</span><span class="p">(</span><span class="n">path_to_df</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">)</span>
<span class="n">mc_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
    <tr>
      <th>guid</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>495e874c-b88a-43a1-852f-c83b120acb3f</th>
      <td>4</td>
      <td>2</td>
      <td>2</td>
      <td>4</td>
      <td>4</td>
      <td>1</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
    </tr>
    <tr>
      <th>67c726e3-029f-4b67-a0e1-681ed9b8709b</th>
      <td>4</td>
      <td>4</td>
      <td>2</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>2</td>
    </tr>
    <tr>
      <th>382f321e-e701-4a03-97f8-466c612ebbc2</th>
      <td>3</td>
      <td>4</td>
      <td>2</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
    </tr>
    <tr>
      <th>77bad106-02c7-48da-9d4a-81c6502f81f3</th>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>2</td>
      <td>4</td>
      <td>1</td>
      <td>2</td>
      <td>4</td>
      <td>2</td>
    </tr>
    <tr>
      <th>81826eda-87be-4aa3-84e3-10650d2af766</th>
      <td>2</td>
      <td>4</td>
      <td>4</td>
      <td>2</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>1</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mc_df</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mc_df</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># getting average of MC results</span>

<span class="c1"># reading pyIncore dataset to geodataframe</span>
<span class="n">road_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;60e5e5cd544e944c3ce37d08&quot;</span>
<span class="n">road_gdf</span> <span class="o">=</span> <span class="n">read_pyincore_gdf</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">road_dataset_id</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;guid&#39;</span><span class="p">)</span>

<span class="c1"># merging the two above</span>
<span class="n">road_mc_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">road_gdf</span><span class="p">,</span> <span class="n">mc_df</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">],</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># plotting results</span>
<span class="n">plot_gdf_map</span><span class="p">(</span><span class="n">road_mc_df</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;avg&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<img alt="../../_images/Notebook1_Seaside_63_1.png" src="../../_images/Notebook1_Seaside_63_1.png" />
</div>
</div>
</div>
<div class="section" id="water-damage">
<h4>Water Damage<a class="headerlink" href="#water-damage" title="Permalink to this headline">¶</a></h4>
<p>Running water facility and water pipe damage for earthquake, tsunami, and cumulative earthquake+tsunami.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Earthquake</span>
<span class="c1"># Pipe damage</span>
<span class="c1"># Initializing pipeline damage and fragility service</span>
<span class="n">pipeline_dmg</span> <span class="o">=</span> <span class="n">PipelineDamageRepairRate</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">fragility_service</span> <span class="o">=</span> <span class="n">FragilityService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="c1"># Seaside pipes</span>
<span class="n">pipe_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;60e72f9fd3c92a78c89636c7&quot;</span>
<span class="n">pipeline_dmg</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;pipeline&quot;</span><span class="p">,</span> <span class="n">pipe_dataset_id</span><span class="p">)</span>


<span class="c1"># seaside pipe fragility mappng for EQ</span>
<span class="n">mapping_id</span> <span class="o">=</span> <span class="s2">&quot;5b47c227337d4a38464efea8&quot;</span>
<span class="n">mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">fragility_service</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">mapping_id</span><span class="p">))</span>
<span class="n">pipeline_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s1">&#39;dfr3_mapping_set&#39;</span><span class="p">,</span> <span class="n">mapping_set</span><span class="p">)</span>

<span class="n">pipeline_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_type&quot;</span><span class="p">,</span> <span class="s1">&#39;earthquake&#39;</span><span class="p">)</span>
<span class="n">pipeline_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;fragility_key&quot;</span><span class="p">,</span><span class="s1">&#39;pgv&#39;</span><span class="p">)</span>
<span class="c1"># pipeline_dmg.set_parameter(&quot;use_liquefaction&quot;,True)</span>
<span class="n">pipeline_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">result_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;pipe_eq_</span><span class="si">{}</span><span class="s1">yr&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">hazard_id</span> <span class="o">=</span> <span class="n">eq_hazard_dict</span><span class="p">[</span><span class="n">ret_prd</span><span class="p">]</span>

<span class="n">pipeline_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_id&quot;</span><span class="p">,</span> <span class="n">hazard_id</span><span class="p">)</span>
<span class="n">pipeline_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span><span class="n">result_name</span><span class="p">)</span>

<span class="c1"># Run pipeline damage analysis</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">pipeline_dmg</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>




<span class="c1"># Facility damage    </span>
<span class="c1"># Initializing water facility damage and fragility service</span>
<span class="n">wterfclty_dmg</span> <span class="o">=</span> <span class="n">WaterFacilityDamage</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">fragility_service</span> <span class="o">=</span> <span class="n">FragilityService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="c1"># loading input dataset</span>
<span class="n">fclty_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;60e5e91960b3f41243faa3b2&quot;</span>
<span class="n">wterfclty_dmg</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;water_facilities&quot;</span><span class="p">,</span> <span class="n">fclty_dataset_id</span><span class="p">)</span>

<span class="c1"># wterfclty Fragility Mapping on incore-service</span>
<span class="n">mapping_id</span> <span class="o">=</span> <span class="s2">&quot;5d39e010b9219cc18bd0b0b6&quot;</span> <span class="c1"># 5 DS</span>
<span class="c1"># mapping_id = &quot;6079f7825b609c56229bf976&quot; # 4 DS</span>
<span class="n">mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">fragility_service</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">mapping_id</span><span class="p">))</span>
<span class="n">wterfclty_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s1">&#39;dfr3_mapping_set&#39;</span><span class="p">,</span> <span class="n">mapping_set</span><span class="p">)</span>

<span class="n">wterfclty_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_type&quot;</span><span class="p">,</span> <span class="s1">&#39;earthquake&#39;</span><span class="p">)</span>
<span class="n">wterfclty_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;fragility_key&quot;</span><span class="p">,</span><span class="s1">&#39;pga&#39;</span><span class="p">)</span>
<span class="n">wterfclty_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">result_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;wterfclty_eq_</span><span class="si">{}</span><span class="s1">yr&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">hazard_id</span> <span class="o">=</span> <span class="n">eq_hazard_dict</span><span class="p">[</span><span class="n">ret_prd</span><span class="p">]</span>

<span class="n">wterfclty_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_id&quot;</span><span class="p">,</span> <span class="n">hazard_id</span><span class="p">)</span>
<span class="n">wterfclty_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span><span class="n">result_name</span><span class="p">)</span>

<span class="c1"># Run pipeline damage analysis</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">wterfclty_dmg</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Earthquake done.&#39;</span><span class="p">)</span>





<span class="c1"># --- Tsunami damage</span>
<span class="c1"># Pipe damage</span>
<span class="c1"># Initialzing pipeline damage and fragility service</span>
<span class="n">pipeline_dmg</span> <span class="o">=</span> <span class="n">PipelineDamage</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">fragility_service</span> <span class="o">=</span> <span class="n">FragilityService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="c1"># Seaside pipes</span>
<span class="n">pipe_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;60e72f9fd3c92a78c89636c7&quot;</span>
<span class="n">pipeline_dmg</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;pipeline&quot;</span><span class="p">,</span> <span class="n">pipe_dataset_id</span><span class="p">)</span>

<span class="c1"># seaside pipe fragility mappng for tsunami</span>
<span class="n">mapping_id</span> <span class="o">=</span> <span class="s2">&quot;5d320a87b9219c6d66398b45&quot;</span> <span class="c1"># 5 DS</span>
<span class="c1"># mapping_id = &quot;6079b7156799d908861e413b&quot; # 4 DS</span>
<span class="n">mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">fragility_service</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">mapping_id</span><span class="p">))</span>
<span class="n">pipeline_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s1">&#39;dfr3_mapping_set&#39;</span><span class="p">,</span> <span class="n">mapping_set</span><span class="p">)</span>

<span class="n">pipeline_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_type&quot;</span><span class="p">,</span> <span class="s1">&#39;tsunami&#39;</span><span class="p">)</span>
<span class="n">pipeline_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;fragility_key&quot;</span><span class="p">,</span> <span class="s2">&quot;Non-Retrofit inundationDepth Fragility ID Code&quot;</span><span class="p">)</span>
<span class="n">pipeline_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">result_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;pipe_tsu_</span><span class="si">{}</span><span class="s1">yr&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">hazard_id</span> <span class="o">=</span> <span class="n">tsu_hazard_dict</span><span class="p">[</span><span class="n">ret_prd</span><span class="p">]</span>

<span class="n">pipeline_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_id&quot;</span><span class="p">,</span> <span class="n">hazard_id</span><span class="p">)</span>
<span class="n">pipeline_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span><span class="n">result_name</span><span class="p">)</span>

<span class="c1"># Run pipeline damage analysis</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">pipeline_dmg</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>



<span class="c1"># Facility damage</span>
<span class="c1"># initialzing water facility damage and fragility service</span>
<span class="n">wterfclty_dmg</span> <span class="o">=</span> <span class="n">WaterFacilityDamage</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">fragility_service</span> <span class="o">=</span> <span class="n">FragilityService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="c1"># loading input dataset</span>
<span class="n">fclty_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;60e5e91960b3f41243faa3b2&quot;</span>
<span class="n">wterfclty_dmg</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;water_facilities&quot;</span><span class="p">,</span> <span class="n">fclty_dataset_id</span><span class="p">)</span>

<span class="c1"># wterfclty Fragility Mapping on incore-service</span>
<span class="n">mapping_id</span> <span class="o">=</span> <span class="s2">&quot;5d31f737b9219c6d66398521&quot;</span> <span class="c1"># 5 DS</span>
<span class="c1"># mapping_id = &quot;6079b8a66799d908861e4bf0&quot; # 4 DS</span>
<span class="n">mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">fragility_service</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">mapping_id</span><span class="p">))</span>
<span class="n">wterfclty_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s1">&#39;dfr3_mapping_set&#39;</span><span class="p">,</span> <span class="n">mapping_set</span><span class="p">)</span>

<span class="n">wterfclty_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_type&quot;</span><span class="p">,</span> <span class="s1">&#39;tsunami&#39;</span><span class="p">)</span>
<span class="n">wterfclty_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;fragility_key&quot;</span><span class="p">,</span><span class="s2">&quot;Non-Retrofit inundationDepth Fragility ID Code&quot;</span><span class="p">)</span>
<span class="n">wterfclty_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="n">result_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;wterfclty_tsu_</span><span class="si">{}</span><span class="s1">yr&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">hazard_id</span> <span class="o">=</span> <span class="n">tsu_hazard_dict</span><span class="p">[</span><span class="n">ret_prd</span><span class="p">]</span>

<span class="n">wterfclty_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_id&quot;</span><span class="p">,</span> <span class="n">hazard_id</span><span class="p">)</span>
<span class="n">wterfclty_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span><span class="n">result_name</span><span class="p">)</span>

<span class="c1"># Run facility damage analysis</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">wterfclty_dmg</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Tsunami done.&#39;</span><span class="p">)</span>




<span class="c1"># --- Cumulative</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Cumulative water damage does not exist in pyIncore yet.&#39;</span><span class="p">)</span>


<span class="c1"># Pipeline damage</span>
<span class="sd">&quot;&quot;&quot; doing MC sampling here for pipes</span>
<span class="sd">    returns mc results:</span>
<span class="sd">        0: failed</span>
<span class="sd">        1: working</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">path_to_eq</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;pipe_eq_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">path_to_ts</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;pipe_tsu_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>

<span class="n">eq_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_to_eq</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ts_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_to_ts</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="sd">&quot;&quot;&quot; pyincore returns failure probs for EQ.</span>
<span class="sd">    assuming pipe has failed if in extensive or complete for tsunami. From HAZUS TMTM</span>
<span class="sd">        Slight: pipeline exposedd due soil erosion; no leakage</span>
<span class="sd">        Moderate: some displacement in pipeline, requiring minor repairs</span>
<span class="sd">        Extensive: pipeline damaged (mainly joint failure) resulting in leakage</span>
<span class="sd">        Complete: multiple pipeline separations at joint and barrel, requiring replacement</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">ts_df</span><span class="p">[</span><span class="s1">&#39;failprob&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_df</span><span class="p">[</span><span class="s1">&#39;DS_3&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ts_df</span><span class="p">[</span><span class="s1">&#39;DS_4&#39;</span><span class="p">]</span>

<span class="n">cumulative_failure_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">eq_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_sims</span><span class="p">):</span>
    <span class="n">rv_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">eq_df</span><span class="p">))</span>
    <span class="n">rv_ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">ts_df</span><span class="p">))</span>

    <span class="n">eq_mc</span> <span class="o">=</span> <span class="n">rv_eq</span><span class="o">&lt;</span><span class="n">eq_df</span><span class="p">[</span><span class="s1">&#39;failprob&#39;</span><span class="p">]</span>
    <span class="n">ts_mc</span> <span class="o">=</span> <span class="n">rv_ts</span><span class="o">&lt;</span><span class="n">ts_df</span><span class="p">[</span><span class="s1">&#39;failprob&#39;</span><span class="p">]</span>

    <span class="n">cumulative_failure_df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">eq_mc</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">ts_mc</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">path_to_mc_results</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_wterpipe_cumulative_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">cumulative_failure_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_to_mc_results</span><span class="p">)</span>

<span class="c1"># Facility Damage</span>

<span class="n">path_to_eq</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;wterfclty_eq_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">path_to_ts</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;wterfclty_tsu_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>

<span class="n">eq_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_to_eq</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ts_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_to_ts</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">cumulative</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">eq_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">cumulative</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> \
    <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span>

<span class="n">cumulative</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> \
    <span class="o">+</span> <span class="p">((</span><span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_0&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]))</span>

<span class="n">cumulative</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> \
    <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> \
    <span class="o">+</span> <span class="p">((</span><span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]))</span>

<span class="n">cumulative</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]</span> \
    <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]</span> \
    <span class="o">+</span> <span class="p">((</span><span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">eq_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ts_df</span><span class="p">[</span><span class="s2">&quot;LS_3&quot;</span><span class="p">]))</span>

<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;DS_0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_0&#39;</span><span class="p">]</span>
<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;DS_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_0&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_1&#39;</span><span class="p">]</span>
<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;DS_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_1&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_2&#39;</span><span class="p">]</span>
<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;DS_3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_2&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_3&#39;</span><span class="p">]</span>
<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;DS_4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;LS_3&#39;</span><span class="p">]</span>

<span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;hazard&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Earthquake+Tsunami&#39;</span>
<span class="n">path_to_cumulative</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;wterfclty_cumulative_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">cumulative</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_to_cumulative</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Earthquake done.
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Tsunami done.

Cumulative water damage does not exist in pyIncore yet.
</pre></div>
</div>
</div>
</div>
<p>Water MC Sampling
<br>
For water facilities. MC for pipes was done above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Water Facility</span>
<span class="n">path_to_cumulative</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;wterfclty_cumulative_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">fclty_dmg_result</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">path_to_cumulative</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;ergo:waterFacilityDamageVer6&#39;</span><span class="p">)</span>
<span class="n">path_to_mc_results</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_wterfclty_cumulative_</span><span class="si">{}</span><span class="s1">yr&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>

<span class="n">mc</span> <span class="o">=</span> <span class="n">MonteCarloFailureProbability</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;damage&quot;</span><span class="p">,</span> <span class="n">fclty_dmg_result</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_samples&quot;</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;damage_interval_keys&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DS_0&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_1&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_2&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_3&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_4&quot;</span><span class="p">])</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;failure_state_keys&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DS_1&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_2&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_3&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_4&quot;</span><span class="p">])</span>

<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">path_to_mc_results</span><span class="p">)</span> <span class="c1"># name of csv file with results</span>
<span class="n">mc</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p><strong>Explore Monte-Carlo Water Damage Results</strong></p>
<p>Only showing pipe failure. Each row is a pipe component, each column is a sample from the Monte-Carlo analysis.</p>
<ul class="simple">
<li><p>0: Failed</p></li>
<li><p>1: Working</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path_to_df</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_wterpipe_cumulative_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">mc_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_to_df</span><span class="p">)</span>
<span class="n">mc_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mc_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
    <tr>
      <th>guid</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>38f200bf-3c64-4994-b4de-36044ae64c00</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>0434090a-1a3f-409d-ad48-24d6f5af68f6</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>972cd313-3101-43ac-b917-c6c6fd7987b0</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8b868727-d59c-4e2a-84ba-c73eea4f8363</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>b04bf9c5-f788-4520-b3db-c2979415a326</th>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mc_df</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mc_df</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># getting average of MC results</span>

<span class="c1"># reading pyIncore dataset to geodataframe</span>
<span class="n">pipe_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;60e72f9fd3c92a78c89636c7&quot;</span>
<span class="n">pipe_gdf</span> <span class="o">=</span> <span class="n">read_pyincore_gdf</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">pipe_dataset_id</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;guid&#39;</span><span class="p">)</span>

<span class="c1"># merging the two above</span>
<span class="n">pipe_mc_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">pipe_gdf</span><span class="p">,</span> <span class="n">mc_df</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">],</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># plotting results</span>
<span class="n">plot_gdf_map</span><span class="p">(</span><span class="n">pipe_mc_df</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;avg&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<img alt="../../_images/Notebook1_Seaside_70_1.png" src="../../_images/Notebook1_Seaside_70_1.png" />
</div>
</div>
<p><a id='3'></a></p>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="functionality">
<h2>3) Functionality<a class="headerlink" href="#functionality" title="Permalink to this headline">¶</a></h2>
<p><img alt="title" src="../../_images/Flowchart_3.png" /><br></p>
<p><a id='3a'></a></p>
<div class="section" id="a-functionality-models">
<h3>3a) Functionality Models<a class="headerlink" href="#a-functionality-models" title="Permalink to this headline">¶</a></h3>
<p>Here, functionality of each infrastructure system is at the parcel-level and is defined as how each respective infrastructure system performs at every parcel. For example, the electric functionality at a particular parcel is defined as whether the parcel has electricity or not. Similarly, the water functionality at a particular parcel is defined as whether the parcel has running water or not.
<br><br>
The following code sets up the electric, transportation, and water functionality models. Each model returns a table. The rows correspond to parcels and the columns correspond to a single MC iteration. A binary variable representing functional (1) or not functional (0) is provided.</p>
<p>Creating some functions that will be used for each infrastructure system</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_pyincore_nx</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">ds_id</span><span class="p">,</span> <span class="n">transportation</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; reading pyincore dataset and loading into networkx graph </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_data_service</span><span class="p">(</span><span class="n">ds_id</span><span class="p">,</span> <span class="n">data_service</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_dataframe_from_shapefile</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>  <span class="c1"># setting dataframe crs</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">26910</span><span class="p">)</span>       <span class="c1"># converting such that crs units is in meters, not lat/long</span>


    <span class="n">temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">length</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span><span class="o">/</span><span class="mf">.3048</span>               <span class="c1"># converting meters to feet </span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Length_miles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="o">/</span><span class="mi">5280</span>  <span class="c1"># converting feet to miles</span>
    <span class="k">if</span> <span class="n">transportation</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Speed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span>            <span class="c1"># assuming 30 mph roads in Seaside</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;travel_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Length_miles&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Speed&#39;</span><span class="p">]</span> <span class="c1"># assuming free flow travel times</span>
        
        <span class="n">G_nx</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_pandas_edgelist</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> 
                                        <span class="n">source</span><span class="o">=</span><span class="s1">&#39;fnode_guid&#39;</span><span class="p">,</span> 
                                        <span class="n">target</span><span class="o">=</span><span class="s1">&#39;tnode_guid&#39;</span><span class="p">,</span> 
                                        <span class="n">edge_key</span> <span class="o">=</span> <span class="s1">&#39;guid&#39;</span><span class="p">,</span>
                                        <span class="n">edge_attr</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="s1">&#39;Length_miles&#39;</span><span class="p">,</span> <span class="s1">&#39;Speed&#39;</span><span class="p">,</span> <span class="s1">&#39;travel_time&#39;</span><span class="p">],</span> 
                                        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">G_nx</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_pandas_edgelist</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> 
                                        <span class="n">source</span><span class="o">=</span><span class="s1">&#39;fnode_guid&#39;</span><span class="p">,</span> 
                                        <span class="n">target</span><span class="o">=</span><span class="s1">&#39;tnode_guid&#39;</span><span class="p">,</span> 
                                        <span class="n">edge_key</span> <span class="o">=</span> <span class="s1">&#39;guid&#39;</span><span class="p">,</span>
                                        <span class="n">edge_attr</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="s1">&#39;Length_miles&#39;</span><span class="p">],</span> 
                                        <span class="p">)</span>
    <span class="n">G_nx</span> <span class="o">=</span> <span class="n">G_nx</span><span class="o">.</span><span class="n">to_undirected</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">G_nx</span>

<span class="k">def</span> <span class="nf">travel_time_calc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">sources</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; returns travel time calculation.</span>
<span class="sd">        Sum of shortest path between all source and target nodes</span>

<span class="sd">        note that p is a dictionary defined by:</span>
<span class="sd">            p = dict(nx.shortest_path_length(G_nx, weight=&#39;len_km&#39;))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sources</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sources</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">targets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="n">tot</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">o_node</span> <span class="ow">in</span> <span class="n">sources</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">d_node</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">o_node</span> <span class="o">==</span> <span class="n">d_node</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">o_node</span><span class="p">][</span><span class="n">d_node</span><span class="p">]</span>
            <span class="n">tot</span> <span class="o">+=</span> <span class="n">dist</span>

    <span class="k">return</span> <span class="n">tot</span>

<span class="k">def</span> <span class="nf">path_length_iterator</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; returns iterator </span>
<span class="sd">        taken from networkx all_pairs_dijkstra_path_length.</span>
<span class="sd">        -modified such that it loops through sources as opposed to all nodes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_paths</span><span class="o">.</span><span class="n">weighted</span><span class="o">.</span><span class="n">_dijkstra_multisource</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_paths</span><span class="o">.</span><span class="n">weighted</span><span class="o">.</span><span class="n">_weight_function</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sources</span><span class="p">:</span>
        <span class="k">yield</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">length</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">sources</span><span class="o">=</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">))</span>



<span class="k">def</span> <span class="nf">find_in_list_of_list</span><span class="p">(</span><span class="n">mylist</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">sub_list</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">sub_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mylist</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sub_list</span><span class="p">)</span>
        

<span class="k">def</span> <span class="nf">restoration_curve</span><span class="p">(</span><span class="n">DS</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">,</span> <span class="n">save_days</span><span class="p">,</span> <span class="n">functionality_percentage</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; uses restoration curves to evaluate the </span>
<span class="sd">        functionality of infrastructure components </span>
<span class="sd">        at a particular day after disruption</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_DS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>    
    <span class="n">Res</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">dists</span> <span class="o">=</span> <span class="p">[</span><span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">stds</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_DS</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">save_days</span><span class="p">:</span>
        <span class="n">Res</span><span class="p">[</span><span class="n">day</span><span class="p">]</span> <span class="o">=</span> <span class="n">DS</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">replace_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">dists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">day</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_DS</span><span class="p">)}</span>
        <span class="n">replace_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># adding 100% functional at for no damage</span>
        <span class="n">Res</span><span class="p">[</span><span class="n">day</span><span class="p">]</span> <span class="o">=</span> <span class="n">Res</span><span class="p">[</span><span class="n">day</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">replace_dict</span><span class="p">)</span> <span class="c1">#.values[:,0]</span>
        <span class="k">if</span> <span class="n">functionality_percentage</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Res</span><span class="p">[</span><span class="n">day</span><span class="p">]</span> <span class="o">=</span> <span class="n">Res</span><span class="p">[</span><span class="n">day</span><span class="p">]</span><span class="o">&gt;</span><span class="n">functionality_percentage</span>
    <span class="k">return</span> <span class="n">Res</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="building-functionality-model">
<h4>Building Functionality Model<a class="headerlink" href="#building-functionality-model" title="Permalink to this headline">¶</a></h4>
<p>Building functionality is defined as whether the sampled damage state results from the Monte-Carlo simulation are below a pre-defined damage state.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">building_func</span><span class="p">(</span><span class="n">mc_dmg</span><span class="p">,</span> <span class="n">func_ds</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; building functionality calculations.</span>
<span class="sd">        buildings are assumed functional is the damage state is less than or equal to &#39;func_ds&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">bldg_mc_dmg</span><span class="o">&lt;=</span><span class="n">func_ds</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">func</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="electric-functionality-model">
<h4>Electric Functionality Model<a class="headerlink" href="#electric-functionality-model" title="Permalink to this headline">¶</a></h4>
<p>Electric functionality is a binary value of 0 (no electricity) or 1 (has electricity). Pole failure probabilities are associated with each damage state. If a pole is failed, it is removed from the network. If a building is connected to the substation via the remaining electric lines, it has electricity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">electric_func</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">mc_dmg</span><span class="p">,</span> <span class="n">bldg2ntwk_df</span><span class="p">,</span> <span class="n">elec_pole_gdf</span><span class="p">,</span> <span class="n">save_days</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1337</span><span class="p">)</span>
    
    <span class="c1"># allocating space to save results</span>
    <span class="n">bldg_conn_save</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">H_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># getting pole functionality at day 1 from restoration curves</span>
    <span class="n">means</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">]</span>
    <span class="n">stds</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>
    <span class="n">functionality_percentage</span><span class="o">=</span><span class="mf">0.8</span>
    <span class="n">mc_func</span> <span class="o">=</span> <span class="n">restoration_curve</span><span class="p">(</span><span class="n">mc_dmg</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">,</span> <span class="n">save_days</span><span class="p">,</span> <span class="n">functionality_percentage</span><span class="p">)</span>
    <span class="n">mc_fail</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="o">~</span><span class="n">mc_func</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mc_func</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>

    <span class="c1"># getting substation functionality at day 1 from restoration curves</span>
    <span class="n">ss_guid</span> <span class="o">=</span> <span class="n">elec_pole_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">elec_pole_gdf</span><span class="p">[</span><span class="s1">&#39;utilfcltyc&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ESSL2&#39;</span><span class="p">][</span><span class="s1">&#39;guid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="n">ss_pole_guid</span> <span class="o">=</span> <span class="s1">&#39;557fe1a3-2ad8-494b-bbc1-d5dfccc4dc3c&#39;</span>

    <span class="n">means</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
    <span class="n">stds</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
    <span class="n">ss_dmg</span> <span class="o">=</span> <span class="n">mc_dmg</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ss_guid</span><span class="p">]</span>
    <span class="n">ss_func</span> <span class="o">=</span> <span class="n">restoration_curve</span><span class="p">(</span><span class="n">ss_dmg</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">,</span> <span class="n">save_days</span><span class="p">,</span> <span class="n">functionality_percentage</span><span class="p">)</span>
    <span class="n">ss_fail</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="o">~</span><span class="n">ss_func</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ss_func</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
    
    <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">save_days</span><span class="p">:</span>  <span class="c1"># looping through days and computing parcel functionality</span>
        <span class="n">bldg_conn_save</span><span class="p">[</span><span class="n">day</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">bldg2ntwk_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">H_dict</span><span class="p">[</span><span class="n">day</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># looping through each iteration</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mc_dmg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">mc_iter</span> <span class="o">=</span> <span class="n">mc_fail</span><span class="p">[</span><span class="n">day</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

            <span class="n">remove_poles</span> <span class="o">=</span> <span class="n">mc_iter</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mc_iter</span><span class="o">==</span><span class="kc">True</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

            <span class="c1"># getting graph for iteration</span>
            <span class="n">H</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">H</span><span class="o">.</span><span class="n">remove_nodes_from</span><span class="p">(</span><span class="n">remove_poles</span><span class="p">)</span>
            <span class="n">bins</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">H</span><span class="p">))</span>

            <span class="n">ss_bin</span> <span class="o">=</span> <span class="n">find_in_list_of_list</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">ss_pole_guid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ss_bin</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>  <span class="c1"># substation </span>
                <span class="n">conn_ss_tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bldg2ntwk_df</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">conn_ss_tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">bldg2ntwk_df</span><span class="p">[</span><span class="s1">&#39;node_guid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="n">ss_bin</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ss_fail</span><span class="p">[</span><span class="n">day</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span> <span class="c1"># if substation failed, then no parcels have electricity; overwriting anything previous</span>
                <span class="n">conn_ss_tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bldg2ntwk_df</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="n">bldg_conn_save</span><span class="p">[</span><span class="n">day</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">conn_ss_tf</span>
            <span class="n">H_dict</span><span class="p">[</span><span class="n">day</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">H</span>
        
    <span class="k">return</span> <span class="n">bldg_conn_save</span><span class="p">,</span> <span class="n">H_dict</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="transportation-functionality-model">
<h4>Transportation Functionality Model<a class="headerlink" href="#transportation-functionality-model" title="Permalink to this headline">¶</a></h4>
<p>Transportation functionality is measured on a scale of 0-1 and is based on the concept of travel time resilience. The transportation functionality is defined at each node in the transportation network and is the ratio of pre- to post-
disaster travel times to all other nodes. That is, the functionality of the transportation network at node <span class="math notranslate nohighlight">\(o\)</span> is defined as:</p>
<div class="math notranslate nohighlight">
\[F(t)_{o, trns} = \frac{\sum\limits_{d\epsilon S} T_{(o,d),0}} {\sum\limits_{d\epsilon S} T_{(o,d),t}} \]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(F(t)_{o, trns}\)</span>: transportation functionality at node <span class="math notranslate nohighlight">\(o\)</span> at time <span class="math notranslate nohighlight">\(t\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(d\)</span>: is a destination node</p></li>
<li><p><span class="math notranslate nohighlight">\(S\)</span>: is all nodes in the transportation network</p></li>
<li><p><span class="math notranslate nohighlight">\(T_{(o,d),t}\)</span>: Travel time between origin node <span class="math notranslate nohighlight">\(o\)</span> and destination node <span class="math notranslate nohighlight">\(d\)</span> at time <span class="math notranslate nohighlight">\(t\)</span></p></li>
</ul>
<p><br><br><br>
Post-disaster travel times along each road/bridge segment are related to HAZUS functionality via:
$<span class="math notranslate nohighlight">\(T'(t)_{pst} = \frac{T'_{pre}} {f(t)} \)</span>$</p>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(T'(t)_{pst}\)</span>: is the travel time along a road segment after the event at time <span class="math notranslate nohighlight">\(t\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(T'_{pre}\)</span>: is the travel time along a road segment before the event. It is assumed this is the distance/speed</p></li>
<li><p><span class="math notranslate nohighlight">\(f(t)\)</span>: is the HAZUS functionality and is related to the damage state of a road/bridge segment via repair curves</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">transportation_func</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">mc_dmg</span><span class="p">,</span> <span class="n">bldg2ntwk_df</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bridge_guids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_days</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1337</span><span class="p">)</span>
    <span class="n">bldg_func_save</span> <span class="o">=</span> <span class="p">{}</span>

    
    
    <span class="sd">&quot;&quot;&quot; HAZUS does not provide joint restoration curves. </span>
<span class="sd">        Assuming a combination of the two by taking the larger of EQ/TSU</span>
<span class="sd">        </span>
<span class="sd">        roads:   Using TSU restoration curves for roads because these are longer than all EQ curves</span>
<span class="sd">        bridges: The following curves are used for each damage state for bridges:</span>
<span class="sd">                - Slight: TSU</span>
<span class="sd">                - Moderate: TSU</span>
<span class="sd">                - Extensive: EQ</span>
<span class="sd">                - Complete: EQ</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># road functionality</span>
    <span class="n">means</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
    <span class="n">stds</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
    <span class="n">mc_func</span> <span class="o">=</span> <span class="n">restoration_curve</span><span class="p">(</span><span class="n">mc_dmg</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">,</span> <span class="n">save_days</span><span class="p">)</span>
    
    <span class="c1"># bridge functionality</span>
    <span class="n">means</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">230</span><span class="p">]</span>
    <span class="n">stds</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">110</span><span class="p">]</span>
    <span class="n">bridge_dmg</span> <span class="o">=</span> <span class="n">mc_dmg</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bridge_guids</span><span class="p">]</span>
    <span class="n">bridge_func</span> <span class="o">=</span> <span class="n">restoration_curve</span><span class="p">(</span><span class="n">bridge_dmg</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">,</span> <span class="n">save_days</span><span class="p">)</span>
    
    <span class="c1"># combining road and bridge functionality</span>
    <span class="n">mc_func</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">bridge_func</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">mc_func</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mc_func</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
    
    
    <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">save_days</span><span class="p">:</span>
        <span class="n">bldg_func_save</span><span class="p">[</span><span class="n">day</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">bldg2ntwk_df</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
      
    
        <span class="c1"># looping through each iteration</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mc_dmg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>       
            <span class="c1"># first getting an updated graph with increased travel times</span>
            <span class="n">H</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
                <span class="n">guid</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;guid&#39;</span><span class="p">]</span>
                <span class="n">t_o</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;travel_time&#39;</span><span class="p">]</span>	<span class="c1"># hours</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">mc_func</span><span class="p">[</span><span class="n">day</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">guid</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="n">H</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;travel_time_post&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_o</span><span class="o">/</span><span class="n">func</span>


            <span class="c1"># now setting up resilience calcs</span>
            <span class="n">sources</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">H</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
            <span class="n">p_locl_pre</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">path_length_iterator</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;travel_time&#39;</span><span class="p">))</span>
            <span class="n">p_locl_pst</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">path_length_iterator</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;travel_time_post&#39;</span><span class="p">))</span>

            <span class="n">node_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">H</span><span class="p">))</span> <span class="c1"># dataframe to store resilience calc from each node</span>
            <span class="n">node_df</span><span class="p">[</span><span class="s1">&#39;tt_resilience&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">H</span><span class="p">):</span> <span class="c1"># loop through each node as the source</span>
                <span class="n">locl_temp_pre</span> <span class="o">=</span> <span class="n">travel_time_calc</span><span class="p">(</span><span class="n">p_locl_pre</span><span class="p">,</span> <span class="n">sources</span><span class="o">=</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">)</span>   <span class="c1"># pre-disaster travel time calc</span>
                <span class="n">locl_temp_pst</span> <span class="o">=</span> <span class="n">travel_time_calc</span><span class="p">(</span><span class="n">p_locl_pst</span><span class="p">,</span> <span class="n">sources</span><span class="o">=</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">)</span>   <span class="c1"># post-disaster travel time calc</span>
                <span class="n">node_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;tt_resilience&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">locl_temp_pre</span><span class="o">/</span><span class="n">locl_temp_pst</span>

            <span class="c1"># merging results to map from nodes to buildings; saving to output dataframe</span>
            <span class="n">temp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">bldg2ntwk_df</span><span class="p">[</span><span class="s1">&#39;node_guid&#39;</span><span class="p">],</span> <span class="n">node_df</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;node_guid&#39;</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">bldg_func_save</span><span class="p">[</span><span class="n">day</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">bldg_func_save</span><span class="p">[</span><span class="n">day</span><span class="p">],</span> <span class="n">temp_df</span><span class="p">[</span><span class="s1">&#39;tt_resilience&#39;</span><span class="p">],</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">bldg_func_save</span><span class="p">[</span><span class="n">day</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;tt_resilience&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bldg_func_save</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="water-functionality-model">
<h4>Water Functionality Model<a class="headerlink" href="#water-functionality-model" title="Permalink to this headline">¶</a></h4>
<p>Water functionality is a binary value, measured on a scale of 0-1. A parcel either has water or it does not. The water network’s dependency on the electric network is captured here. For the testbed, there is one water treatment plant, and three water pumping stations. Each parcel is assigned to one of the three water pumping stations.</p>
<p>Thus, assuming parcel <span class="math notranslate nohighlight">\(j\)</span> is assigned to water pumping station <span class="math notranslate nohighlight">\(i\)</span>, the following conditions must be met for this parcel to have water:</p>
<ol class="simple">
<li><p>The electric substation, water treatment plant, and water pumping station <span class="math notranslate nohighlight">\(i\)</span> must be operable</p></li>
<li><p>The water treatment plant must be connected to the electric substation (via the electric network)</p></li>
<li><p>Water pumping station <span class="math notranslate nohighlight">\(i\)</span> must be connected to the electric substation (via the electric network)</p></li>
<li><p>The water treatment plant must be connected to water pumping station <span class="math notranslate nohighlight">\(i\)</span> (via the water network)</p></li>
<li><p>Water pumping station <span class="math notranslate nohighlight">\(i\)</span> must be connected to parcel <span class="math notranslate nohighlight">\(j\)</span> (via the water network)</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">water_func</span><span class="p">(</span><span class="n">G_wter</span><span class="p">,</span> <span class="n">G_elec_dict</span><span class="p">,</span> <span class="n">mc_fail_pipe</span><span class="p">,</span> <span class="n">fclty_mc_dmg</span><span class="p">,</span> <span class="n">elec_mc_dmg</span><span class="p">,</span> 
               <span class="n">bldg2ntwk_df</span><span class="p">,</span> <span class="n">elec_pole_gdf</span><span class="p">,</span> <span class="n">fclty_gdf</span><span class="p">,</span> <span class="n">pipe_gdf</span><span class="p">,</span> <span class="n">save_days</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span> 
    
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1337</span><span class="p">)</span>
    <span class="n">bldg_conn_save</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="c1"># pipe repair rates</span>
    <span class="sd">&quot;&quot;&quot; using the probability of failure, rather than leak/break.</span>
<span class="sd">        assuming that the repair rate is the average of the leak/break</span>
<span class="sd">        repair rates from hazus.</span>
<span class="sd">                break   leak.   avg.</span>
<span class="sd">        &gt; 20&quot; - 0.33    0.66    0.50</span>
<span class="sd">        &lt; 20&quot; - 0.50    1.00    0.75</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pipe_reprate</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">]</span>   <span class="c1"># Fixed pipes per Day per Worker (&gt;20&quot;, &lt;20&quot; diameter)</span>
    <span class="n">n_workers</span> <span class="o">=</span> <span class="mi">32</span>
    <span class="n">pipe_unit_len</span> <span class="o">=</span> <span class="mi">20</span>      <span class="c1"># assuming unit length of 20m for pipes</span>
    <span class="n">pipe_gdf</span><span class="p">[</span><span class="s1">&#39;n_pipes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pipe_gdf</span><span class="p">[</span><span class="s1">&#39;length_km&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">pipe_unit_len</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span>
    <span class="n">pipe_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pipe_gdf</span><span class="p">[</span><span class="s1">&#39;diameter&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;reprate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipe_reprate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>	<span class="c1"># num pipes/day/worker</span>
    <span class="n">pipe_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pipe_gdf</span><span class="p">[</span><span class="s1">&#39;diameter&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;reprate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipe_reprate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>	<span class="c1"># num pipes/day/worker</span>
    <span class="n">pipe_gdf</span><span class="p">[</span><span class="s1">&#39;reptime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">pipe_gdf</span><span class="p">[</span><span class="s1">&#39;n_pipes&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">pipe_gdf</span><span class="p">[</span><span class="s1">&#39;reprate&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">n_workers</span><span class="p">)</span><span class="o">*</span><span class="mi">24</span><span class="o">/</span><span class="mi">16</span>	<span class="c1"># workdays</span>

    
    <span class="c1"># getting wps functionality at day 1 from restoration curves</span>
    <span class="n">means</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="mf">13.5</span><span class="p">,</span> <span class="mi">35</span><span class="p">]</span>
    <span class="n">stds</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">2.7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span>
    <span class="n">functionality_percentage</span><span class="o">=</span><span class="mf">0.8</span>
    <span class="n">mc_func_fclty</span> <span class="o">=</span> <span class="n">restoration_curve</span><span class="p">(</span><span class="n">fclty_mc_dmg</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">,</span> <span class="n">save_days</span><span class="p">,</span> <span class="n">functionality_percentage</span><span class="p">)</span>
    <span class="n">mc_fail_fclty</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="o">~</span><span class="n">mc_func_fclty</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mc_func_fclty</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>

    <span class="c1"># getting wtp functionality at day 1 from restoration curves</span>
    <span class="n">means</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">95</span><span class="p">]</span>
    <span class="n">stds</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">65</span><span class="p">]</span>
    <span class="n">functionality_percentage</span><span class="o">=</span><span class="mf">0.8</span>
    <span class="n">wtp_guid</span> <span class="o">=</span> <span class="n">fclty_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fclty_gdf</span><span class="p">[</span><span class="s1">&#39;utilfcltyc&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;PWT2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="n">wtp_mc_dmg</span> <span class="o">=</span> <span class="n">fclty_mc_dmg</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">wtp_guid</span><span class="p">]</span>
    <span class="n">wtp_func</span> <span class="o">=</span> <span class="n">restoration_curve</span><span class="p">(</span><span class="n">wtp_mc_dmg</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">,</span> <span class="n">save_days</span><span class="p">,</span> <span class="n">functionality_percentage</span><span class="p">)</span>
    <span class="n">wtp_func</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">wtp_func</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">wtp_func</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>

    <span class="n">wtp_fail</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="o">~</span><span class="n">wtp_func</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">wtp_func</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
    <span class="n">mc_func_fclty</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">wtp_func</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">mc_func_fclty</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mc_func_fclty</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
    <span class="n">mc_fail_fclty</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="o">~</span><span class="n">mc_func_fclty</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mc_func_fclty</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
    
    <span class="c1"># getting wtp functionality at day 1 from restoration curves</span>
    <span class="n">ss_guid</span> <span class="o">=</span> <span class="n">elec_pole_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">elec_pole_gdf</span><span class="p">[</span><span class="s1">&#39;utilfcltyc&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ESSL2&#39;</span><span class="p">][</span><span class="s1">&#39;guid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="n">ss_pole_guid</span> <span class="o">=</span> <span class="s1">&#39;557fe1a3-2ad8-494b-bbc1-d5dfccc4dc3c&#39;</span>

    <span class="n">means</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
    <span class="n">stds</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
    <span class="n">ss_dmg</span> <span class="o">=</span> <span class="n">elec_mc_dmg</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ss_guid</span><span class="p">]</span>
    <span class="n">mc_func_ss</span> <span class="o">=</span> <span class="n">restoration_curve</span><span class="p">(</span><span class="n">ss_dmg</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">,</span> <span class="n">save_days</span><span class="p">,</span> <span class="n">functionality_percentage</span><span class="p">)</span>
    <span class="n">mc_fail_ss</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="o">~</span><span class="n">mc_func_ss</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mc_func_ss</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
    
    <span class="c1">#------------------</span>
    
    <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">save_days</span><span class="p">:</span>
        <span class="c1"># getting wtp and wps guid&#39;s (both guid associated with facility and with the nearest node)</span>
        <span class="n">wtp_guid</span> <span class="o">=</span> <span class="n">fclty_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fclty_gdf</span><span class="p">[</span><span class="s1">&#39;utilfcltyc&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;PWT2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">wps_guids</span> <span class="o">=</span> <span class="n">fclty_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fclty_gdf</span><span class="p">[</span><span class="s1">&#39;utilfcltyc&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;PPP2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="n">wtp_wter_node_guid</span> <span class="o">=</span> <span class="n">fclty_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fclty_gdf</span><span class="p">[</span><span class="s1">&#39;utilfcltyc&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;PWT2&#39;</span><span class="p">][</span><span class="s1">&#39;node_guid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">wps_wter_node_guid</span> <span class="o">=</span> <span class="n">fclty_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fclty_gdf</span><span class="p">[</span><span class="s1">&#39;utilfcltyc&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;PPP2&#39;</span><span class="p">][</span><span class="s1">&#39;node_guid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="n">bldg_conn_save</span><span class="p">[</span><span class="n">day</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">bldg2ntwk_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pipe_mc_dmg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">G_elec_iter</span> <span class="o">=</span> <span class="n">G_elec_dict</span><span class="p">[</span><span class="n">day</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># getting damaged electric network as graph (from electric_func())</span>

            <span class="c1"># assuming everything is operable until determined otherwise</span>
            <span class="n">ss_operable_tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bldg2ntwk_df</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># substation operable</span>
            <span class="n">ss_conn_wtp_tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bldg2ntwk_df</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># substation connected to water treatment plant</span>
            <span class="n">ss_conn_wps_tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bldg2ntwk_df</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># substation connected to water pumping stations</span>
            <span class="n">wtp_conn_wps</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bldg2ntwk_df</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># water treatment plant connected to water pumping station</span>
            <span class="n">wps_conn_parcl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bldg2ntwk_df</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># water pumping station connected to parcel</span>

            <span class="c1"># --- 1) is electric substation operable?</span>
            <span class="k">if</span> <span class="n">mc_fail_ss</span><span class="p">[</span><span class="n">day</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
                <span class="n">ss_operable_tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bldg2ntwk_df</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="c1"># --- 2) &amp; 3) is the water treatment plant and pumping stations connected to electric substation (via G_elec)?</span>
            <span class="n">elec_bins</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">G_elec_iter</span><span class="p">))</span>
            <span class="n">ss_bin</span> <span class="o">=</span> <span class="n">find_in_list_of_list</span><span class="p">(</span><span class="n">elec_bins</span><span class="p">,</span> <span class="n">ss_pole_guid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ss_bin</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span> <span class="c1"># getting binary indicator of whether each water facility has electricity</span>
                <span class="n">fclty_conn_ss_tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fclty_gdf</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fclty_conn_ss_tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">fclty_gdf</span><span class="p">[</span><span class="s1">&#39;elec_node&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(</span><span class="n">elec_bins</span><span class="p">[</span><span class="n">ss_bin</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="n">fclty_gdf</span><span class="p">[</span><span class="s1">&#39;ss_conn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fclty_conn_ss_tf</span>  <span class="c1"># saving for iteration</span>

            <span class="c1"># if water treatment plant doesn&#39;t have electricity, or is inoperable</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">fclty_gdf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">wtp_guid</span><span class="p">,</span> <span class="s1">&#39;ss_conn&#39;</span><span class="p">]</span><span class="o">==</span><span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mc_func_fclty</span><span class="p">[</span><span class="n">day</span><span class="p">]</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">wtp_guid</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="kc">False</span><span class="p">):</span>
                <span class="n">ss_conn_wtp_tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bldg2ntwk_df</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wps_wter_node_guid</span><span class="p">)):</span>    <span class="c1"># now, loop through water pumping stations</span>
                <span class="n">wps_guid</span> <span class="o">=</span> <span class="n">wps_guids</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                <span class="n">wps_node_guid</span> <span class="o">=</span> <span class="n">wps_wter_node_guid</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>   <span class="c1"># getting one water pumping station guid</span>

                <span class="c1"># getting parcels and indices assigned to this pumping station</span>
                <span class="n">parcel_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">bldg2ntwk_df</span><span class="p">[</span><span class="s1">&#39;wp_guid&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">wps_guid</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1"># if water pumping station doesn&#39;t have electricity, parcels assigned to pumping station don&#39;t have water</span>
                <span class="k">if</span> <span class="n">fclty_gdf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">wps_guid</span><span class="p">,</span> <span class="s1">&#39;ss_conn&#39;</span><span class="p">]</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>  
                    <span class="n">ss_conn_wps_tf</span><span class="p">[</span><span class="n">parcel_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parcel_idx</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

                <span class="c1"># elif facility has electricity and is functional</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">fclty_gdf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">wps_guid</span><span class="p">,</span> <span class="s1">&#39;ss_conn&#39;</span><span class="p">]</span><span class="o">==</span><span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">mc_func_fclty</span><span class="p">[</span><span class="n">day</span><span class="p">]</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">wps_guid</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="kc">True</span><span class="p">):</span> 
                    <span class="n">ss_conn_wps_tf</span><span class="p">[</span><span class="n">parcel_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parcel_idx</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>


            <span class="c1"># remove failed pipes from water graph</span>
            <span class="n">mc_iter</span> <span class="o">=</span> <span class="n">mc_fail_pipe</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
            <span class="n">mc_iter</span> <span class="o">=</span> <span class="n">mc_iter</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mc_iter</span><span class="o">==</span><span class="kc">True</span><span class="p">]</span>
            <span class="n">mc_iter</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">mc_iter</span><span class="p">,</span> <span class="n">pipe_gdf</span><span class="p">[</span><span class="s1">&#39;reptime&#39;</span><span class="p">],</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">mc_iter</span> <span class="o">=</span> <span class="n">mc_iter</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1337</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
            <span class="n">mc_iter</span><span class="p">[</span><span class="s1">&#39;cumulative_reptime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">mc_iter</span><span class="p">[</span><span class="s1">&#39;reptime&#39;</span><span class="p">])</span>
            <span class="n">remove_pipes</span> <span class="o">=</span> <span class="n">mc_iter</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mc_iter</span><span class="p">[</span><span class="s1">&#39;cumulative_reptime&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">day</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

            <span class="c1"># getting water graph for iteration</span>
            <span class="n">H</span> <span class="o">=</span> <span class="n">G_wter</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ebunch</span> <span class="o">=</span> <span class="p">[(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edges</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;guid&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">remove_pipes</span><span class="p">]</span>
            <span class="n">H</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">ebunch</span><span class="p">)</span>

            <span class="c1"># --- 4) water treatment plant connected to water pumping station i (via G_wter) </span>
            <span class="n">wter_bins</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">H</span><span class="p">))</span>
            <span class="n">wtp_bin</span> <span class="o">=</span> <span class="n">find_in_list_of_list</span><span class="p">(</span><span class="n">wter_bins</span><span class="p">,</span> <span class="n">wtp_wter_node_guid</span><span class="p">)</span> <span class="c1"># water treatment plant bin</span>

            <span class="k">if</span> <span class="n">wtp_bin</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fclty_conn_wtp_tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wps_wter_node_guid</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fclty_conn_wtp_tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">wps_wter_node_guid</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">wter_bins</span><span class="p">[</span><span class="n">wtp_bin</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">wtp_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">fclty_gdf</span><span class="p">[</span><span class="s1">&#39;utilfcltyc&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;PWT2&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">fclty_conn_wtp_tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">fclty_conn_wtp_tf</span><span class="p">,</span> <span class="n">wtp_idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># inserting 1 b/c wtp is connected to wtp</span>
            <span class="n">fclty_gdf</span><span class="p">[</span><span class="s1">&#39;wps_conn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fclty_conn_wtp_tf</span>  <span class="c1"># saving water facility connection results temporarily</span>


            <span class="c1"># --- 5) water pumping station i connected to parcel j (via G_wter)</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wps_wter_node_guid</span><span class="p">)):</span>
                <span class="n">wps_guid</span> <span class="o">=</span> <span class="n">wps_guids</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>  <span class="c1"># getting wps guid and node guid</span>
                <span class="n">wps_node_guid</span> <span class="o">=</span> <span class="n">wps_wter_node_guid</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>

                <span class="c1"># getting parcels (and indices) assigned to this water pumping station</span>
                <span class="n">parcel_nodes</span> <span class="o">=</span> <span class="n">bldg2ntwk_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bldg2ntwk_df</span><span class="p">[</span><span class="s1">&#39;wp_guid&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">wps_guid</span><span class="p">][</span><span class="s1">&#39;node_guid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

                <span class="n">parcel_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">bldg2ntwk_df</span><span class="p">[</span><span class="s1">&#39;wp_guid&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">wps_guid</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">wps_bin</span> <span class="o">=</span> <span class="n">find_in_list_of_list</span><span class="p">(</span><span class="n">wter_bins</span><span class="p">,</span> <span class="n">wps_node_guid</span><span class="p">)</span>  <span class="c1"># the water bin that the pumping station is in</span>
                <span class="k">if</span> <span class="n">wps_bin</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>  <span class="c1"># substation </span>
                    <span class="n">wps_conn_parcl</span><span class="p">[</span><span class="n">parcel_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parcel_nodes</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">wps_conn_parcl</span><span class="p">[</span><span class="n">parcel_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">parcel_nodes</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">wter_bins</span><span class="p">[</span><span class="n">wps_bin</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="n">conn_wter_tf</span> <span class="o">=</span> <span class="n">ss_operable_tf</span> <span class="o">&amp;</span> <span class="n">ss_conn_wtp_tf</span> <span class="o">&amp;</span> <span class="n">ss_conn_wps_tf</span> <span class="o">&amp;</span> <span class="n">wtp_conn_wps</span> <span class="o">&amp;</span> <span class="n">wps_conn_parcl</span>
            <span class="n">bldg_conn_save</span><span class="p">[</span><span class="n">day</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">conn_wter_tf</span>

    
    <span class="k">return</span> <span class="n">bldg_conn_save</span>
</pre></div>
</div>
</div>
</div>
<p><a id='3b'></a></p>
</div>
</div>
<div class="section" id="b-functionality-of-physical-infrastructure">
<h3>3b) Functionality of Physical Infrastructure<a class="headerlink" href="#b-functionality-of-physical-infrastructure" title="Permalink to this headline">¶</a></h3>
<p>Using the above functionality modules to determine the functionality of each infrastructure system at every parcel. Note that as “functionality” is defined as a binary variable at every parcel for each infrastructure system (e.g., does parcel <em>j</em> have electricity, does parcel <em>j</em> have water, <em>etc.</em>), the following plots show the probability of each parcel being functional.</p>
<div class="section" id="building-functionality">
<h4>Building Functionality<a class="headerlink" href="#building-functionality" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path_to_df</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_buildings_cumulative_</span><span class="si">{}</span><span class="s1">yr_sample_damage_states.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">bldg_mc_dmg</span> <span class="o">=</span> <span class="n">read_MC_results</span><span class="p">(</span><span class="n">path_to_df</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">)</span>

<span class="n">bldg_func</span> <span class="o">=</span> <span class="n">building_func</span><span class="p">(</span><span class="n">bldg_mc_dmg</span><span class="p">,</span> <span class="n">func_ds</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># plotting average functionality</span>
<span class="n">bldg_func</span><span class="p">[</span><span class="s1">&#39;bldg_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bldg_func</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">if</span> <span class="s1">&#39;bldg_avg&#39;</span> <span class="ow">in</span> <span class="n">bldg_df</span><span class="p">:</span>
    <span class="k">del</span> <span class="n">bldg_df</span><span class="p">[</span><span class="s1">&#39;bldg_avg&#39;</span><span class="p">]</span>
<span class="n">bldg_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">bldg_df</span><span class="p">,</span> <span class="n">bldg_func</span><span class="p">[</span><span class="s1">&#39;bldg_avg&#39;</span><span class="p">],</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plot_gdf_map</span><span class="p">(</span><span class="n">bldg_df</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;bldg_avg&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;magma&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Notebook1_Seaside_85_0.png" src="../../_images/Notebook1_Seaside_85_0.png" />
</div>
</div>
</div>
<div class="section" id="electric-functionality">
<h4>Electric Functionality<a class="headerlink" href="#electric-functionality" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">elec_ntwk_id</span> <span class="o">=</span> <span class="s1">&#39;60e5e326544e944c3ce37a93&#39;</span>
<span class="n">elec_pole_id</span> <span class="o">=</span> <span class="s2">&quot;5d263f08b9219cf93c056c68&quot;</span>
<span class="n">bldg2elec_id</span> <span class="o">=</span> <span class="s1">&#39;60e5e40c544e944c3ce37ae3&#39;</span>

<span class="n">G_elec</span> <span class="o">=</span> <span class="n">read_pyincore_nx</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">elec_ntwk_id</span><span class="p">)</span>
<span class="n">bldg2elec_df</span> <span class="o">=</span> <span class="n">read_pyincore_df</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">bldg2elec_id</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;bldg_guid&#39;</span><span class="p">)</span>
<span class="n">elec_pole_gdf</span> <span class="o">=</span> <span class="n">read_pyincore_gdf</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">elec_pole_id</span><span class="p">)</span>

<span class="n">path_to_df</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_electric_cumulative_</span><span class="si">{}</span><span class="s1">yr_sample_damage_states.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">elec_mc_dmg</span> <span class="o">=</span> <span class="n">read_MC_results</span><span class="p">(</span><span class="n">path_to_df</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">)</span>

<span class="c1"># computing electric functionality</span>
<span class="n">elec_func</span><span class="p">,</span> <span class="n">G_elec_dict</span> <span class="o">=</span> <span class="n">electric_func</span><span class="p">(</span>
                            <span class="n">G</span><span class="o">=</span><span class="n">G_elec</span><span class="p">,</span> 
                            <span class="n">mc_dmg</span><span class="o">=</span><span class="n">elec_mc_dmg</span><span class="p">,</span> 
                            <span class="n">bldg2ntwk_df</span><span class="o">=</span><span class="n">bldg2elec_df</span><span class="p">,</span> 
                            <span class="n">elec_pole_gdf</span><span class="o">=</span><span class="n">elec_pole_gdf</span><span class="p">)</span>
<span class="n">elec_func</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># plotting average functionality</span>
<span class="n">elec_func</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;elec_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elec_func</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">if</span> <span class="s1">&#39;elec_avg&#39;</span> <span class="ow">in</span> <span class="n">bldg_df</span><span class="p">:</span>
    <span class="k">del</span> <span class="n">bldg_df</span><span class="p">[</span><span class="s1">&#39;elec_avg&#39;</span><span class="p">]</span>
<span class="n">bldg_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">bldg_df</span><span class="p">,</span> <span class="n">elec_func</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;elec_avg&#39;</span><span class="p">],</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plot_gdf_map</span><span class="p">(</span><span class="n">bldg_df</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;elec_avg&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;magma&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<img alt="../../_images/Notebook1_Seaside_87_1.png" src="../../_images/Notebook1_Seaside_87_1.png" />
</div>
</div>
</div>
<div class="section" id="transportation-functionality">
<h4>Transportation Functionality<a class="headerlink" href="#transportation-functionality" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># defining trans ID&#39;s</span>
<span class="n">trns_ntwk_id</span> <span class="o">=</span> <span class="s1">&#39;60e5e5cd544e944c3ce37d08&#39;</span>
<span class="n">bldg2trns_id</span> <span class="o">=</span> <span class="s1">&#39;60e5e75c544e944c3ce380cf&#39;</span>
<span class="n">bridge_id</span> <span class="o">=</span> <span class="s1">&#39;60e5e576d3c92a78c893ff69&#39;</span>

<span class="c1"># reading in trans data</span>
<span class="n">G_trns</span> <span class="o">=</span> <span class="n">read_pyincore_nx</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">trns_ntwk_id</span><span class="p">,</span> <span class="n">transportation</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">bldg2trns_df</span> <span class="o">=</span> <span class="n">read_pyincore_df</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">bldg2trns_id</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;bldg_guid&#39;</span><span class="p">)</span>
<span class="n">bridge_gdf</span> <span class="o">=</span> <span class="n">read_pyincore_gdf</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">bridge_id</span><span class="p">)</span>

<span class="c1"># setting up dict that maps bridge to road segments</span>
<span class="n">brdg2road_dict</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">bridge_gdf</span><span class="o">.</span><span class="n">link_guid</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">bridge_gdf</span><span class="o">.</span><span class="n">guid</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

<span class="c1"># reading in MC results</span>
<span class="n">path_to_df</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_road_cumulative_</span><span class="si">{}</span><span class="s1">yr_sample_damage_states.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">road_mc_dmg</span> <span class="o">=</span> <span class="n">read_MC_results</span><span class="p">(</span><span class="n">path_to_df</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">)</span>

<span class="n">path_to_df</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_bridge_cumulative_</span><span class="si">{}</span><span class="s1">yr_sample_damage_states.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">bridge_mc_dmg</span> <span class="o">=</span> <span class="n">read_MC_results</span><span class="p">(</span><span class="n">path_to_df</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">)</span>

<span class="c1"># bridge_guids = list(bridge_mc_dmg.index)</span>
<span class="n">bridge_guids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">brdg2road_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c1"># replacing bridge guid with the road guid that it&#39;s on</span>
<span class="n">bridge_mc_dmg</span> <span class="o">=</span> <span class="n">bridge_mc_dmg</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="n">brdg2road_dict</span><span class="p">})</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;guid&#39;</span><span class="p">)</span>

<span class="c1"># combining bridge and road damage</span>
<span class="n">trns_mc_dmg</span> <span class="o">=</span> <span class="n">bridge_mc_dmg</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">road_mc_dmg</span><span class="p">)</span>

<span class="c1"># computing transportation functionality</span>
<span class="n">trns_func</span> <span class="o">=</span> <span class="n">transportation_func</span><span class="p">(</span>
                    <span class="n">G</span><span class="o">=</span><span class="n">G_trns</span><span class="p">,</span> 
                    <span class="n">mc_dmg</span><span class="o">=</span><span class="n">trns_mc_dmg</span><span class="p">,</span> 
                    <span class="n">bldg2ntwk_df</span><span class="o">=</span><span class="n">bldg2trns_df</span><span class="p">,</span> 
                    <span class="n">day</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                    <span class="n">bridge_guids</span><span class="o">=</span><span class="n">bridge_guids</span>
                    <span class="p">)</span>

<span class="c1"># plotting average functionality</span>
<span class="n">trns_func</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;trns_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trns_func</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">if</span> <span class="s1">&#39;trns_avg&#39;</span> <span class="ow">in</span> <span class="n">bldg_df</span><span class="p">:</span>
    <span class="k">del</span> <span class="n">bldg_df</span><span class="p">[</span><span class="s1">&#39;trns_avg&#39;</span><span class="p">]</span>
<span class="n">bldg_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">bldg_df</span><span class="p">,</span> <span class="n">trns_func</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;trns_avg&#39;</span><span class="p">],</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plot_gdf_map</span><span class="p">(</span><span class="n">bldg_df</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;trns_avg&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;magma&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<img alt="../../_images/Notebook1_Seaside_89_1.png" src="../../_images/Notebook1_Seaside_89_1.png" />
</div>
</div>
</div>
<div class="section" id="water-functionality">
<h4>Water Functionality<a class="headerlink" href="#water-functionality" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wter_ntwk_id</span> <span class="o">=</span> <span class="s1">&#39;60e72f9fd3c92a78c89636c7&#39;</span>
<span class="n">wter_fclty_id</span> <span class="o">=</span> <span class="s1">&#39;60e5e91960b3f41243faa3b2&#39;</span>
<span class="n">bldg2wter_id</span> <span class="o">=</span> <span class="s1">&#39;60e5e7dbd3c92a78c8940505&#39;</span>

<span class="n">elec_ntwk_id</span> <span class="o">=</span> <span class="s1">&#39;60e5e326544e944c3ce37a93&#39;</span>
<span class="n">elec_pole_id</span> <span class="o">=</span> <span class="s2">&quot;5d263f08b9219cf93c056c68&quot;</span>


<span class="n">G_wter</span> <span class="o">=</span> <span class="n">read_pyincore_nx</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">wter_ntwk_id</span><span class="p">)</span>
<span class="n">G_elec</span> <span class="o">=</span> <span class="n">read_pyincore_nx</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">elec_ntwk_id</span><span class="p">)</span>
<span class="n">wter_fclty_gdf</span> <span class="o">=</span> <span class="n">read_pyincore_gdf</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">wter_fclty_id</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;guid&#39;</span><span class="p">)</span>
<span class="n">wter_pipe_gdf</span> <span class="o">=</span> <span class="n">read_pyincore_gdf</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">wter_ntwk_id</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;guid&#39;</span><span class="p">)</span>
<span class="n">bldg2wter_df</span> <span class="o">=</span> <span class="n">read_pyincore_df</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">bldg2wter_id</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;bldg_guid&#39;</span><span class="p">)</span>
<span class="n">elec_pole_gdf</span> <span class="o">=</span> <span class="n">read_pyincore_gdf</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">elec_pole_id</span><span class="p">)</span>

<span class="n">path_to_mc_pipe</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_wterpipe_cumulative_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">path_to_mc_fclty</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_wterfclty_cumulative_</span><span class="si">{}</span><span class="s1">yr_sample_damage_states.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">path_to_mc_elec</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_electric_cumulative_</span><span class="si">{}</span><span class="s1">yr_sample_damage_states.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>

<span class="n">pipe_mc_dmg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_to_mc_pipe</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">fclty_mc_dmg</span> <span class="o">=</span> <span class="n">read_MC_results</span><span class="p">(</span><span class="n">path_to_mc_fclty</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">)</span>
<span class="n">elec_mc_dmg</span> <span class="o">=</span> <span class="n">read_MC_results</span><span class="p">(</span><span class="n">path_to_mc_elec</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">)</span>

<span class="n">wter_func</span> <span class="o">=</span> <span class="n">water_func</span><span class="p">(</span>
                <span class="n">G_wter</span><span class="o">=</span><span class="n">G_wter</span><span class="p">,</span> 
                <span class="n">G_elec_dict</span><span class="o">=</span><span class="n">G_elec_dict</span><span class="p">,</span> 
                <span class="n">mc_fail_pipe</span><span class="o">=</span><span class="n">pipe_mc_dmg</span><span class="p">,</span> 
                <span class="n">fclty_mc_dmg</span><span class="o">=</span><span class="n">fclty_mc_dmg</span><span class="p">,</span> 
                <span class="n">elec_mc_dmg</span><span class="o">=</span><span class="n">elec_mc_dmg</span><span class="p">,</span>
                <span class="n">bldg2ntwk_df</span><span class="o">=</span><span class="n">bldg2wter_df</span><span class="p">,</span> 
                <span class="n">elec_pole_gdf</span><span class="o">=</span><span class="n">elec_pole_gdf</span><span class="p">,</span> 
                <span class="n">fclty_gdf</span><span class="o">=</span><span class="n">wter_fclty_gdf</span><span class="p">,</span>
                <span class="n">pipe_gdf</span><span class="o">=</span><span class="n">wter_pipe_gdf</span><span class="p">,</span>
                <span class="p">)</span>


<span class="c1"># plotting average functionality</span>
<span class="n">wter_func</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;wter_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wter_func</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">if</span> <span class="s1">&#39;wter_avg&#39;</span> <span class="ow">in</span> <span class="n">bldg_df</span><span class="p">:</span>
    <span class="k">del</span> <span class="n">bldg_df</span><span class="p">[</span><span class="s1">&#39;wter_avg&#39;</span><span class="p">]</span>
<span class="n">bldg_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">bldg_df</span><span class="p">,</span> <span class="n">wter_func</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;wter_avg&#39;</span><span class="p">],</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plot_gdf_map</span><span class="p">(</span><span class="n">bldg_df</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;wter_avg&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;magma&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<img alt="../../_images/Notebook1_Seaside_91_1.png" src="../../_images/Notebook1_Seaside_91_1.png" />
</div>
</div>
<p><a id='3c'></a></p>
</div>
</div>
<div class="section" id="c-cge-model">
<h3>3c) CGE Model<a class="headerlink" href="#c-cge-model" title="Permalink to this headline">¶</a></h3>
<p>Using the Seaside CGE model to determine indirect economic losses within Seaside.</p>
<div class="section" id="getting-building-failure-results">
<h4>Getting building failure results<a class="headerlink" href="#getting-building-failure-results" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bldg_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;613ba5ef5d3b1d6461e8c415&quot;</span>        <span class="c1"># defining building dataset (GIS point layer)</span>
<span class="n">building_inv</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_data_service</span><span class="p">(</span><span class="n">bldg_dataset_id</span><span class="p">,</span> <span class="n">data_service</span><span class="p">)</span>

<span class="n">path_to_building_fail</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> 
                                     <span class="s1">&#39;mc_buildings_cumulative_</span><span class="si">{}</span><span class="s1">yr_failure_probability.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">df_bldg_fail</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_to_building_fail</span><span class="p">)</span>
<span class="n">df_bldg_fail</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>guid</th>
      <th>LS_0</th>
      <th>LS_1</th>
      <th>LS_2</th>
      <th>DS_0</th>
      <th>DS_1</th>
      <th>DS_2</th>
      <th>DS_3</th>
      <th>hazard</th>
      <th>failure_probability</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>fba4c73f-9b1b-4942-b7fb-bc276a4e0a4e</td>
      <td>0.677877</td>
      <td>0.275702</td>
      <td>0.076840</td>
      <td>0.322123</td>
      <td>0.402175</td>
      <td>0.198862</td>
      <td>0.076840</td>
      <td>Earthquake+Tsunami</td>
      <td>0.7</td>
    </tr>
    <tr>
      <th>1</th>
      <td>65d6e370-c05b-4b2f-bd17-d914d1d056c7</td>
      <td>0.588779</td>
      <td>0.186784</td>
      <td>0.034291</td>
      <td>0.411221</td>
      <td>0.401995</td>
      <td>0.152493</td>
      <td>0.034291</td>
      <td>Earthquake+Tsunami</td>
      <td>0.7</td>
    </tr>
    <tr>
      <th>2</th>
      <td>dad76485-9694-409e-ac7f-c64c7bd5c32c</td>
      <td>0.677877</td>
      <td>0.275702</td>
      <td>0.076840</td>
      <td>0.322123</td>
      <td>0.402175</td>
      <td>0.198862</td>
      <td>0.076840</td>
      <td>Earthquake+Tsunami</td>
      <td>0.6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6f57cfb6-d244-40d5-96f5-03aeddd5e30a</td>
      <td>0.605391</td>
      <td>0.200326</td>
      <td>0.041418</td>
      <td>0.394609</td>
      <td>0.405065</td>
      <td>0.158908</td>
      <td>0.041418</td>
      <td>Earthquake+Tsunami</td>
      <td>0.5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>929f1040-6224-409d-b4e3-58946daf3b91</td>
      <td>0.676490</td>
      <td>0.272583</td>
      <td>0.072864</td>
      <td>0.323510</td>
      <td>0.403907</td>
      <td>0.199718</td>
      <td>0.072864</td>
      <td>Earthquake+Tsunami</td>
      <td>0.8</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="capital-shock-analysis">
<h4>Capital Shock Analysis<a class="headerlink" href="#capital-shock-analysis" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">building_failure_probability</span> <span class="o">=</span> <span class="n">mc_bldg</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s1">&#39;failure_probability&#39;</span><span class="p">)</span>  <span class="c1"># get buildings failure probabilities</span>

<span class="c1"># shock is defined as of percentage reductions in the capital stock of the associated sectors.  </span>
<span class="n">capital_shocks</span> <span class="o">=</span> <span class="n">CapitalShocks</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="c1"># Specify the result name</span>

<span class="n">result_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s2">&quot;Seaside capital losses&quot;</span><span class="p">)</span>

<span class="c1"># Set analysis parameters</span>
<span class="n">capital_shocks</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">result_name</span><span class="p">)</span>


<span class="c1"># Load input datasets</span>
<span class="c1"># Seaside building to sector mapping table</span>
<span class="n">building_to_sectors_id</span> <span class="o">=</span> <span class="s2">&quot;5f5fd8e2980a301080a03996&quot;</span>


<span class="c1"># Load remote datasets</span>
<span class="n">capital_shocks</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;buildings_to_sectors&quot;</span><span class="p">,</span> <span class="n">building_to_sectors_id</span><span class="p">)</span>

<span class="c1"># Set datasets</span>
<span class="c1"># Seaside building inventory</span>
<span class="n">capital_shocks</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;buildings&quot;</span><span class="p">,</span> <span class="n">building_inv</span><span class="p">)</span>  <span class="c1"># loading the shapefile directly! </span>

<span class="c1"># Seaside building failure probability</span>
<span class="n">capital_shocks</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;failure_probability&quot;</span><span class="p">,</span> <span class="n">building_failure_probability</span><span class="p">)</span>
<span class="n">capital_shocks</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="showings-results-from-capital-shock">
<h4>Showings results from capital shock<a class="headerlink" href="#showings-results-from-capital-shock" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sector_shocks_result</span> <span class="o">=</span> <span class="n">capital_shocks</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s2">&quot;sector_shocks&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">sector_shocks_result</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sector</th>
      <th>shock</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>HS3</td>
      <td>0.398454</td>
    </tr>
    <tr>
      <th>1</th>
      <td>HS2</td>
      <td>0.366205</td>
    </tr>
    <tr>
      <th>2</th>
      <td>HS1</td>
      <td>0.260014</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SERV2</td>
      <td>0.334935</td>
    </tr>
    <tr>
      <th>4</th>
      <td>SERV1</td>
      <td>0.268557</td>
    </tr>
    <tr>
      <th>5</th>
      <td>REST1</td>
      <td>0.284067</td>
    </tr>
    <tr>
      <th>6</th>
      <td>RETAIL2</td>
      <td>0.292893</td>
    </tr>
    <tr>
      <th>7</th>
      <td>REST2</td>
      <td>0.170589</td>
    </tr>
    <tr>
      <th>8</th>
      <td>RETAIL1</td>
      <td>0.271149</td>
    </tr>
    <tr>
      <th>9</th>
      <td>ACCOM1</td>
      <td>0.177750</td>
    </tr>
    <tr>
      <th>10</th>
      <td>HC2</td>
      <td>0.167218</td>
    </tr>
    <tr>
      <th>11</th>
      <td>UTIL</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>12</th>
      <td>CONST2</td>
      <td>0.382224</td>
    </tr>
    <tr>
      <th>13</th>
      <td>SERV3</td>
      <td>0.344529</td>
    </tr>
    <tr>
      <th>14</th>
      <td>MANUF2</td>
      <td>0.389899</td>
    </tr>
    <tr>
      <th>15</th>
      <td>HC3</td>
      <td>0.370032</td>
    </tr>
    <tr>
      <th>16</th>
      <td>AG3</td>
      <td>0.300000</td>
    </tr>
    <tr>
      <th>17</th>
      <td>CONST3</td>
      <td>0.500793</td>
    </tr>
    <tr>
      <th>18</th>
      <td>CONST1</td>
      <td>0.541323</td>
    </tr>
    <tr>
      <th>19</th>
      <td>HC1</td>
      <td>0.212091</td>
    </tr>
    <tr>
      <th>20</th>
      <td>ACCOM2</td>
      <td>0.333531</td>
    </tr>
    <tr>
      <th>21</th>
      <td>AG2</td>
      <td>0.600000</td>
    </tr>
    <tr>
      <th>22</th>
      <td>RETAIL3</td>
      <td>0.600000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="running-cge">
<h4>Running CGE<a class="headerlink" href="#running-cge" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">SAM </span>
<span class="sd">Social accounting matrix (SAM) contains data for firms, households and government which are organized </span>
<span class="sd">in a way to represent the interactions of all three entities in a typical economy</span>
<span class="sd">each cell shows payment from its column account to its row account&quot;&quot;&quot;</span>

<span class="n">SAM</span> <span class="o">=</span> <span class="s2">&quot;5f17393633b2700c11feab38&quot;</span>

<span class="sd">&quot;&quot;&quot;CAPITAL COMP</span>
<span class="sd">BB is a matrix which describes how investment in physical infrastructure is transformed into functioning capital such as commercial and residential buildings. </span>
<span class="sd">These data are collected from the Bureau of Economic Analysis (BEA).&quot;&quot;&quot;</span>
<span class="n">BB</span> <span class="o">=</span> <span class="s2">&quot;603d23d634f29a7fa41c4c4e&quot;</span>

<span class="c1"># MISC TABLES</span>
<span class="n">EMPLOY</span> <span class="o">=</span> <span class="s2">&quot;5f173c97c98cf43417c8955d&quot;</span> <span class="c1"># Table name containing data for commercial sector employment.</span>
<span class="n">JOBCR</span> <span class="o">=</span> <span class="s2">&quot;5f173d262fab4d660a8e9f9c&quot;</span> <span class="c1"># This is a matrix describing the supply of workers coming from each household group in the economy.</span>
<span class="n">HHTABLE</span> <span class="o">=</span> <span class="s2">&quot;5f173d6bc98cf43417c89561&quot;</span> <span class="c1"># HH Table</span>
<span class="n">SIMS</span> <span class="o">=</span> <span class="s2">&quot;5f174211c98cf43417c89565&quot;</span> <span class="c1"># Random numbers for the change of capital stocks in the CGE model.</span>


<span class="c1"># Create Seaside CGE Model</span>
<span class="n">seaside_cge</span> <span class="o">=</span> <span class="n">SeasideCGEModel</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="c1"># Set analysis input datasets</span>
<span class="n">seaside_cge</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;SAM&quot;</span><span class="p">,</span> <span class="n">SAM</span><span class="p">)</span>
<span class="n">seaside_cge</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;BB&quot;</span><span class="p">,</span> <span class="n">BB</span><span class="p">)</span>
<span class="n">seaside_cge</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;EMPLOY&quot;</span><span class="p">,</span> <span class="n">EMPLOY</span><span class="p">)</span>
<span class="n">seaside_cge</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;JOBCR&quot;</span><span class="p">,</span> <span class="n">JOBCR</span><span class="p">)</span>
<span class="n">seaside_cge</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;HHTABLE&quot;</span><span class="p">,</span> <span class="n">HHTABLE</span><span class="p">)</span>
<span class="n">seaside_cge</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;SIMS&quot;</span><span class="p">,</span> <span class="n">SIMS</span><span class="p">)</span>

<span class="c1"># Set analysis input dataset from previous Capital stock shock analysis</span>
<span class="n">seaside_cge</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;sector_shocks&quot;</span><span class="p">,</span> <span class="n">sector_shocks_result</span><span class="p">)</span>

<span class="c1"># Run Seaside CGE model analysis</span>
<span class="n">seaside_cge</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A dataset containing Seaside cge simulations (format: CSV).</span>
<span class="c1"># dsc+dsr = domestic supply</span>
<span class="n">domestic_supply</span> <span class="o">=</span> <span class="n">seaside_cge</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s1">&#39;Seaside_Sims&#39;</span><span class="p">)</span>
<span class="n">df_fp</span> <span class="o">=</span> <span class="n">domestic_supply</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">df_fp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dsc</th>
      <th>dsr</th>
      <th>mig</th>
      <th>emp</th>
      <th>hhinc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-352511.619979</td>
      <td>-20880.976172</td>
      <td>-98.845753</td>
      <td>-482.375566</td>
      <td>-47712.549854</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><a id='3d'></a></p>
</div>
</div>
<div class="section" id="d-social-science-modules">
<h3>3d) Social Science Modules<a class="headerlink" href="#d-social-science-modules" title="Permalink to this headline">¶</a></h3>
<p>Using the population dislocation module in pyIncore to determine whether households are dislocated. Chains results from cumulative building damage and housing unit allocation with the population dislocation method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pop_dis</span> <span class="o">=</span> <span class="n">PopulationDislocation</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">1111</span>
<span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1">#Reading in local building damage files</span>
<span class="n">path_to_dmg</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;buildings_cumulative_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">dmg_data</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">path_to_dmg</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;ergo:buildingDamageVer5&#39;</span><span class="p">)</span>
<span class="n">pop_dis</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;building_dmg&quot;</span><span class="p">,</span> <span class="n">dmg_data</span><span class="p">)</span>

<span class="c1"># loading remote population dislocation data </span>
<span class="n">path_to_hua</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;hua_0_</span><span class="si">{}</span><span class="s1">.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">seed</span><span class="p">))</span>
<span class="n">path_to_hua</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;hua_df.csv&#39;</span><span class="p">)</span>
<span class="n">hua</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">path_to_hua</span><span class="p">,</span><span class="s1">&#39;incore:housingUnitAllocation&#39;</span><span class="p">)</span>

<span class="n">pop_dis</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;housing_unit_allocation&quot;</span><span class="p">,</span> <span class="n">hua</span><span class="p">)</span>
<span class="n">pop_dis</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;block_group_data&quot;</span><span class="p">,</span> <span class="s2">&quot;5d542bd8b9219c0689b90408&quot;</span><span class="p">)</span>
<span class="n">pop_dis</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;value_poss_param&quot;</span><span class="p">,</span> <span class="s2">&quot;60354810e379f22e16560dbd&quot;</span><span class="p">)</span> 

<span class="c1"># setting population dislocation run information</span>
<span class="n">result_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s2">&quot;PopDis_results&quot;</span><span class="p">)</span>
<span class="n">pop_dis</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">result_name</span><span class="p">)</span>
<span class="n">pop_dis</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;seed&quot;</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>

<span class="c1"># running population dislocation</span>
<span class="n">pop_dis</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>

<span class="c1"># getting population dislocation results</span>
<span class="n">PopDisResult</span> <span class="o">=</span> <span class="n">pop_dis</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">)</span>
<span class="n">PopDis_df</span> <span class="o">=</span> <span class="n">PopDisResult</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">PopDis_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;guid&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># merging with bldg_df</span>
<span class="k">if</span> <span class="s1">&#39;dislocated&#39;</span> <span class="ow">in</span> <span class="n">bldg_df</span><span class="p">:</span>
    <span class="k">del</span> <span class="n">bldg_df</span><span class="p">[</span><span class="s1">&#39;dislocated&#39;</span><span class="p">]</span>
<span class="n">bldg_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">bldg_df</span><span class="p">,</span> <span class="n">PopDis_df</span><span class="p">[</span><span class="s1">&#39;dislocated&#39;</span><span class="p">],</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">PopDis_df</span><span class="p">[</span><span class="s1">&#39;dislocated&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>guid
37532fb5-5107-478b-ab2c-158eb001c68b     True
e38d8575-7880-4a8c-b6d7-225ab1cf9264    False
66d39314-1c68-4634-a82c-8fcb37f529ff    False
af5771b4-4f42-4166-b772-78a3706fa8ac    False
8f6e055b-2df8-461b-80a0-ba0c1f65add5     True
                                        ...  
9fe9160c-4b71-405a-a45f-46ceebbd57d1    False
a5be3e8a-8010-4a1f-8b9a-bd5b3c2d5075    False
ba5e1e1c-3870-4b6b-acec-5775aba2f3c0    False
81d16960-ccc3-4494-9470-cdb32de4053e    False
5452a060-588c-40be-9639-2f0ea76a6491    False
Name: dislocated, Length: 6980, dtype: bool
</pre></div>
</div>
</div>
</div>
<p><a id='3e'></a></p>
</div>
<div class="section" id="e-direct-and-indirect-economic-social-losses">
<h3>3e) Direct and Indirect Economic &amp; Social Losses<a class="headerlink" href="#e-direct-and-indirect-economic-social-losses" title="Permalink to this headline">¶</a></h3>
<p><strong>Plotting results from population dislocation analysis</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_gdf_map</span><span class="p">(</span><span class="n">bldg_df</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;dislocated&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Notebook1_Seaside_106_0.png" src="../../_images/Notebook1_Seaside_106_0.png" />
</div>
</div>
<p><strong>Showing table of results from CGE analysis</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A dataset of changes in employment and supply. (format: CSV).</span>
<span class="c1"># Employment (unit = person)</span>
<span class="n">gross_income</span> <span class="o">=</span> <span class="n">seaside_cge</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s1">&#39;Seaside_output&#39;</span><span class="p">)</span>
<span class="n">df_fpp</span> <span class="o">=</span> <span class="n">gross_income</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">df_fpp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Seaside</th>
      <th>Amount of Change</th>
      <th>Percent Change</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Total Employment</td>
      <td>-338.55</td>
      <td>-9.15%</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Domestic Supply(mil of $)</td>
      <td>-373392.60</td>
      <td>-25.35%</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Real Household Income(mil of $)</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>HH1</td>
      <td>-147.79</td>
      <td>-6.43%</td>
    </tr>
    <tr>
      <th>4</th>
      <td>HH2</td>
      <td>-3143.78</td>
      <td>-11.41%</td>
    </tr>
    <tr>
      <th>5</th>
      <td>HH3</td>
      <td>-17046.70</td>
      <td>-12.93%</td>
    </tr>
    <tr>
      <th>6</th>
      <td>HH4</td>
      <td>-11216.34</td>
      <td>-13.78%</td>
    </tr>
    <tr>
      <th>7</th>
      <td>HH5</td>
      <td>-42646.03</td>
      <td>-15.03%</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Total</td>
      <td>-74200.64</td>
      <td>-14.09%</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Local Tax Revenue(mil of $)</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>10</th>
      <td>LOCTAX</td>
      <td>-129.36</td>
      <td>-8.85%</td>
    </tr>
    <tr>
      <th>11</th>
      <td>PROPTX</td>
      <td>-207.43</td>
      <td>-5.93%</td>
    </tr>
    <tr>
      <th>12</th>
      <td>ACCTAX</td>
      <td>-94.93</td>
      <td>-13.79%</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Total</td>
      <td>-431.72</td>
      <td>-7.64%</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><a id='4'></a></p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="recovery">
<h2>4) Recovery<a class="headerlink" href="#recovery" title="Permalink to this headline">¶</a></h2>
<img src="images/Flowchart_4.png" width="400"><p><a id='4'></a></p>
<div class="section" id="id1">
<h3>4) Recovery<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Setting up a restoration function. In this notebook, HAZUS restoration curves are used. The restoration curves describe the functionality of infrastructure components as a funtion of time.</p>
<p>This section of the code loops through the previous section; however, the functionality is modified based on the time in days after the CSZ occurs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">stop</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">step</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">save_days</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">+</span><span class="n">step</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
<span class="k">if</span> <span class="n">save_days</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">save_days</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="electric-recovery">
<h4>Electric Recovery<a class="headerlink" href="#electric-recovery" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">elec_ntwk_id</span> <span class="o">=</span> <span class="s1">&#39;60e5e326544e944c3ce37a93&#39;</span>
<span class="n">elec_pole_id</span> <span class="o">=</span> <span class="s2">&quot;5d263f08b9219cf93c056c68&quot;</span>
<span class="n">bldg2elec_id</span> <span class="o">=</span> <span class="s1">&#39;60e5e40c544e944c3ce37ae3&#39;</span>

<span class="n">G_elec</span> <span class="o">=</span> <span class="n">read_pyincore_nx</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">elec_ntwk_id</span><span class="p">)</span>
<span class="n">bldg2elec_df</span> <span class="o">=</span> <span class="n">read_pyincore_df</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">bldg2elec_id</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;bldg_guid&#39;</span><span class="p">)</span>
<span class="n">elec_pole_gdf</span> <span class="o">=</span> <span class="n">read_pyincore_gdf</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">elec_pole_id</span><span class="p">)</span>

<span class="n">path_to_df</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_electric_cumulative_</span><span class="si">{}</span><span class="s1">yr_sample_damage_states.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">elec_mc_dmg</span> <span class="o">=</span> <span class="n">read_MC_results</span><span class="p">(</span><span class="n">path_to_df</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">)</span>

<span class="c1"># computing electric functionality</span>
<span class="n">elec_func</span><span class="p">,</span> <span class="n">G_elec_dict</span> <span class="o">=</span> <span class="n">electric_func</span><span class="p">(</span>
                            <span class="n">G</span><span class="o">=</span><span class="n">G_elec</span><span class="p">,</span> 
                            <span class="n">mc_dmg</span><span class="o">=</span><span class="n">elec_mc_dmg</span><span class="p">,</span> 
                            <span class="n">bldg2ntwk_df</span><span class="o">=</span><span class="n">bldg2elec_df</span><span class="p">,</span> 
                            <span class="n">elec_pole_gdf</span><span class="o">=</span><span class="n">elec_pole_gdf</span><span class="p">,</span>
                            <span class="n">save_days</span><span class="o">=</span><span class="n">save_days</span><span class="p">)</span>

<span class="n">elec_mean</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">elec_std</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">save_days</span><span class="p">:</span>
    <span class="n">elec_func_day</span> <span class="o">=</span> <span class="n">elec_func</span><span class="p">[</span><span class="n">day</span><span class="p">]</span>
    <span class="n">elec_mean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elec_func_day</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">elec_std</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elec_func_day</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    
<span class="n">elec_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elec_mean</span><span class="p">)</span>
<span class="n">elec_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elec_std</span><span class="p">)</span>
<span class="n">elec_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">elec_mean</span> <span class="o">+</span> <span class="n">elec_std</span><span class="p">,</span> <span class="n">a_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">a_max</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">elec_func</span><span class="p">[</span><span class="n">day</span><span class="p">]))</span>
<span class="n">elec_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">elec_mean</span> <span class="o">-</span> <span class="n">elec_std</span><span class="p">,</span> <span class="n">a_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">a_max</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">elec_func</span><span class="p">[</span><span class="n">day</span><span class="p">]))</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">save_days</span><span class="p">,</span> <span class="n">elec_mean</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">save_days</span><span class="p">,</span> <span class="n">elec_lower</span><span class="p">,</span> <span class="n">elec_upper</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (days)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Number of Parcels with Electricity&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Number of Parcels with Electricity&#39;)
</pre></div>
</div>
<img alt="../../_images/Notebook1_Seaside_113_2.png" src="../../_images/Notebook1_Seaside_113_2.png" />
</div>
</div>
</div>
<div class="section" id="transportation-recovery">
<h4>Transportation Recovery<a class="headerlink" href="#transportation-recovery" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># defining trans ID&#39;s</span>
<span class="n">trns_ntwk_id</span> <span class="o">=</span> <span class="s1">&#39;60e5e5cd544e944c3ce37d08&#39;</span>
<span class="n">bldg2trns_id</span> <span class="o">=</span> <span class="s1">&#39;60e5e75c544e944c3ce380cf&#39;</span>
<span class="n">bridge_id</span> <span class="o">=</span> <span class="s1">&#39;60e5e576d3c92a78c893ff69&#39;</span>

<span class="c1"># reading in trans data</span>
<span class="n">G_trns</span> <span class="o">=</span> <span class="n">read_pyincore_nx</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">trns_ntwk_id</span><span class="p">,</span> <span class="n">transportation</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">bldg2trns_df</span> <span class="o">=</span> <span class="n">read_pyincore_df</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">bldg2trns_id</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;bldg_guid&#39;</span><span class="p">)</span>
<span class="n">bridge_gdf</span> <span class="o">=</span> <span class="n">read_pyincore_gdf</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">bridge_id</span><span class="p">)</span>

<span class="c1"># setting up dict that maps bridge to road segments</span>
<span class="n">brdg2road_dict</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">bridge_gdf</span><span class="o">.</span><span class="n">link_guid</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">bridge_gdf</span><span class="o">.</span><span class="n">guid</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

<span class="c1"># reading in MC results</span>
<span class="n">path_to_df</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_road_cumulative_</span><span class="si">{}</span><span class="s1">yr_sample_damage_states.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">road_mc_dmg</span> <span class="o">=</span> <span class="n">read_MC_results</span><span class="p">(</span><span class="n">path_to_df</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">)</span>

<span class="n">path_to_df</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_bridge_cumulative_</span><span class="si">{}</span><span class="s1">yr_sample_damage_states.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">bridge_mc_dmg</span> <span class="o">=</span> <span class="n">read_MC_results</span><span class="p">(</span><span class="n">path_to_df</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">)</span>

<span class="c1"># bridge_guids = list(bridge_mc_dmg.index)</span>
<span class="n">bridge_guids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">brdg2road_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c1"># replacing bridge guid with the road guid that it&#39;s on</span>
<span class="n">bridge_mc_dmg</span> <span class="o">=</span> <span class="n">bridge_mc_dmg</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="n">brdg2road_dict</span><span class="p">})</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;guid&#39;</span><span class="p">)</span>

<span class="c1"># combining bridge and road damage</span>
<span class="n">trns_mc_dmg</span> <span class="o">=</span> <span class="n">bridge_mc_dmg</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">road_mc_dmg</span><span class="p">)</span>

<span class="c1"># computing transportation functionality</span>
<span class="n">trns_func</span> <span class="o">=</span> <span class="n">transportation_func</span><span class="p">(</span>
                    <span class="n">G</span><span class="o">=</span><span class="n">G_trns</span><span class="p">,</span> 
                    <span class="n">mc_dmg</span><span class="o">=</span><span class="n">trns_mc_dmg</span><span class="p">,</span> 
                    <span class="n">bldg2ntwk_df</span><span class="o">=</span><span class="n">bldg2trns_df</span><span class="p">,</span> 
                    <span class="n">day</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                    <span class="n">bridge_guids</span><span class="o">=</span><span class="n">bridge_guids</span><span class="p">,</span>
                    <span class="n">save_days</span><span class="o">=</span><span class="n">save_days</span>
                    <span class="p">)</span>


<span class="n">trns_func_level</span> <span class="o">=</span> <span class="mf">0.75</span>
<span class="n">trns_mean</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">trns_std</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">save_days</span><span class="p">:</span>
    <span class="n">trns_func_day</span> <span class="o">=</span> <span class="n">trns_func</span><span class="p">[</span><span class="n">day</span><span class="p">]</span><span class="o">&gt;</span><span class="n">trns_func_level</span>
    <span class="n">trns_mean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trns_func_day</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">trns_std</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trns_func_day</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    
<span class="n">trns_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">trns_mean</span><span class="p">)</span>
<span class="n">trns_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">trns_std</span><span class="p">)</span>
<span class="n">trns_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">trns_mean</span> <span class="o">+</span> <span class="n">trns_std</span><span class="p">,</span> <span class="n">a_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">a_max</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">trns_func</span><span class="p">[</span><span class="n">day</span><span class="p">]))</span>
<span class="n">trns_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">trns_mean</span> <span class="o">-</span> <span class="n">trns_std</span><span class="p">,</span> <span class="n">a_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">a_max</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">trns_func</span><span class="p">[</span><span class="n">day</span><span class="p">]))</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">save_days</span><span class="p">,</span> <span class="n">trns_mean</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">save_days</span><span class="p">,</span> <span class="n">trns_lower</span><span class="p">,</span> <span class="n">trns_upper</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="c1"># ax.set_xscale(&#39;log&#39;)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (days)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Number of Parcels with Transportation Func. Above </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trns_func_level</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Number of Parcels with Transportation Func. Above 0.75&#39;)
</pre></div>
</div>
<img alt="../../_images/Notebook1_Seaside_115_2.png" src="../../_images/Notebook1_Seaside_115_2.png" />
</div>
</div>
</div>
<div class="section" id="water-recovery">
<h4>Water Recovery<a class="headerlink" href="#water-recovery" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wter_ntwk_id</span> <span class="o">=</span> <span class="s1">&#39;60e72f9fd3c92a78c89636c7&#39;</span>
<span class="n">wter_fclty_id</span> <span class="o">=</span> <span class="s1">&#39;60e5e91960b3f41243faa3b2&#39;</span>
<span class="n">bldg2wter_id</span> <span class="o">=</span> <span class="s1">&#39;60e5e7dbd3c92a78c8940505&#39;</span>

<span class="n">elec_ntwk_id</span> <span class="o">=</span> <span class="s1">&#39;60e5e326544e944c3ce37a93&#39;</span>
<span class="n">elec_pole_id</span> <span class="o">=</span> <span class="s2">&quot;5d263f08b9219cf93c056c68&quot;</span>


<span class="n">G_wter</span> <span class="o">=</span> <span class="n">read_pyincore_nx</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">wter_ntwk_id</span><span class="p">)</span>
<span class="n">G_elec</span> <span class="o">=</span> <span class="n">read_pyincore_nx</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">elec_ntwk_id</span><span class="p">)</span>
<span class="n">wter_fclty_gdf</span> <span class="o">=</span> <span class="n">read_pyincore_gdf</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">wter_fclty_id</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;guid&#39;</span><span class="p">)</span>
<span class="n">wter_pipe_gdf</span> <span class="o">=</span> <span class="n">read_pyincore_gdf</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">wter_ntwk_id</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;guid&#39;</span><span class="p">)</span>
<span class="n">bldg2wter_df</span> <span class="o">=</span> <span class="n">read_pyincore_df</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">bldg2wter_id</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;bldg_guid&#39;</span><span class="p">)</span>
<span class="n">elec_pole_gdf</span> <span class="o">=</span> <span class="n">read_pyincore_gdf</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">elec_pole_id</span><span class="p">)</span>


<span class="n">path_to_mc_pipe</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_wterpipe_cumulative_</span><span class="si">{}</span><span class="s1">yr.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">path_to_mc_fclty</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_wterfclty_cumulative_</span><span class="si">{}</span><span class="s1">yr_sample_damage_states.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>
<span class="n">path_to_mc_elec</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_output</span><span class="p">,</span> <span class="s1">&#39;mc_electric_cumulative_</span><span class="si">{}</span><span class="s1">yr_sample_damage_states.csv&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_prd</span><span class="p">))</span>

<span class="n">pipe_mc_dmg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_to_mc_pipe</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">fclty_mc_dmg</span> <span class="o">=</span> <span class="n">read_MC_results</span><span class="p">(</span><span class="n">path_to_mc_fclty</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">)</span>
<span class="n">elec_mc_dmg</span> <span class="o">=</span> <span class="n">read_MC_results</span><span class="p">(</span><span class="n">path_to_mc_elec</span><span class="p">,</span> <span class="n">n_sims</span><span class="p">)</span>

<span class="n">wter_func</span> <span class="o">=</span> <span class="n">water_func</span><span class="p">(</span>
                <span class="n">G_wter</span><span class="o">=</span><span class="n">G_wter</span><span class="p">,</span> 
                <span class="n">G_elec_dict</span><span class="o">=</span><span class="n">G_elec_dict</span><span class="p">,</span> 
                <span class="n">mc_fail_pipe</span><span class="o">=</span><span class="n">pipe_mc_dmg</span><span class="p">,</span> 
                <span class="n">fclty_mc_dmg</span><span class="o">=</span><span class="n">fclty_mc_dmg</span><span class="p">,</span> 
                <span class="n">elec_mc_dmg</span><span class="o">=</span><span class="n">elec_mc_dmg</span><span class="p">,</span>
                <span class="n">bldg2ntwk_df</span><span class="o">=</span><span class="n">bldg2wter_df</span><span class="p">,</span> 
                <span class="n">elec_pole_gdf</span><span class="o">=</span><span class="n">elec_pole_gdf</span><span class="p">,</span> 
                <span class="n">fclty_gdf</span><span class="o">=</span><span class="n">wter_fclty_gdf</span><span class="p">,</span>
                <span class="n">pipe_gdf</span><span class="o">=</span><span class="n">wter_pipe_gdf</span><span class="p">,</span>
                <span class="n">save_days</span><span class="o">=</span><span class="n">save_days</span><span class="p">)</span>



<span class="n">wter_mean</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">wter_std</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">save_days</span><span class="p">:</span>
    <span class="n">wter_func_day</span> <span class="o">=</span> <span class="n">wter_func</span><span class="p">[</span><span class="n">day</span><span class="p">]</span>
    <span class="n">wter_mean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wter_func_day</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">wter_std</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wter_func_day</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    
<span class="n">wter_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wter_mean</span><span class="p">)</span>
<span class="n">wter_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wter_std</span><span class="p">)</span>
<span class="n">wter_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">wter_mean</span> <span class="o">+</span> <span class="n">wter_std</span><span class="p">,</span> <span class="n">a_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">a_max</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">wter_func</span><span class="p">[</span><span class="n">day</span><span class="p">]))</span>
<span class="n">wter_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">wter_mean</span> <span class="o">-</span> <span class="n">wter_std</span><span class="p">,</span> <span class="n">a_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">a_max</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">wter_func</span><span class="p">[</span><span class="n">day</span><span class="p">]))</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">save_days</span><span class="p">,</span> <span class="n">wter_mean</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">save_days</span><span class="p">,</span> <span class="n">wter_lower</span><span class="p">,</span> <span class="n">wter_upper</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="c1"># ax.set_xscale(&#39;log&#39;)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (days)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Number of Parcels with Water&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Number of Parcels with Water&#39;)
</pre></div>
</div>
<img alt="../../_images/Notebook1_Seaside_117_2.png" src="../../_images/Notebook1_Seaside_117_2.png" />
</div>
</div>
<p><a id='ref'></a></p>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Guidotti, R., Gardoni, P., and Rosenheim, N. (2019). Integration of Physical Infrastructure and Social Systems in Communities’ Reliability and Resilience Analysis. <em>Reliability Engineering &amp; System Safety</em>, 185, 476-492. <a class="reference external" href="https://doi.org/10.1016/j.ress.2019.01.008">https://doi.org/10.1016/j.ress.2019.01.008</a></p></li>
<li><p>Kameshwar, S., Cox, D., Barbosa, A., Farokhnia, K., Park, H., Alam, M., and van de Lindt, J. (2019). Probabilistic Decision-Support Framework for Community Resilience: Incorporating Multi-Hazards, Infrastructure Interdependencies, and Resilience Goals in a Bayesian Network. <em>Reliability Engineering and System Safety</em>, 191. <a class="reference external" href="https://doi.org/10.1016/j.ress.2019.106568">https://doi.org/10.1016/j.ress.2019.106568</a></p></li>
<li><p>Kameshwar, S., Park, H., Cox, D., and Barbosa, A. (2021). Effect of Disaster Debris, Floodwater Pooling Duration, and Bridge Damage on Immediate Post-Tsunami Connectivity. <em>International Journal of Disaster Risk Reduction</em>, 56. <a class="reference external" href="https://doi.org/10.1016/j.ijdrr.2021.102119">https://doi.org/10.1016/j.ijdrr.2021.102119</a></p></li>
<li><p>Park, H., and Cox, D. (2016). Probabilistic Assessment of Near-Field Tsunami Hazards: Inundation Depth, Velocity, Momentum Flux, Arrival Time, and Duration Applied to Seaside, Oregon. <em>Coastal Engineering</em>, 117, 79-96. <a class="reference external" href="https://doi.org/10.1016/j.coastaleng.2016.07.011">https://doi.org/10.1016/j.coastaleng.2016.07.011</a></p></li>
<li><p>Park, H., Cox, D., and Barbosa, A. (2017a). Comparison of inundation depth and momentum flux based fragilities for probabilistic tsunami damage assessment and uncertainty analysis. <em>Coastal Engineering</em>, 122, 10-26. <a class="reference external" href="https://doi.org//10.1016/j.coastaleng.2017.01.008">https://doi.org//10.1016/j.coastaleng.2017.01.008</a></p></li>
<li><p>Park, H., Cox, D., Alam, M., and Barbosa, A. (2017b). Probabilistic Seismic and Tsunami Hazard Analysis Conditioned on a Megathrust Rupture of the Cascadia Subduction Zone. <em>Frontiers in Built Environment</em>, 3, 32. <a class="reference external" href="https://doi.org/10.3389/fbuil.2017.00032">https://doi.org/10.3389/fbuil.2017.00032</a></p></li>
<li><p>Park, H., Alam, M., Cox, D., Barbosa, A., and van de Lindt, J. (2019). Probabilistic Seismic and Tsunami Damage Analysis (PSTDA) of the Cascadia Subduction Zone Applied to Seaside, Oregon. <em>International Journal of Disaster Risk Reduction</em>, 35. <a class="reference external" href="https://doi.org/10.1016/j.ijdrr.2019.101076">https://doi.org/10.1016/j.ijdrr.2019.101076</a></p></li>
<li><p>Rosenheim, N., Guidotti, R., Gardoni, P., and Peacock, W. (2019). Integration of Detailed Household and Housing Unit Characteristic Data with Critical Infrastructure for Post-Hazard Resilience Modeling. <em>Sustainable and Resilient Infrastructure</em>, 1-17. <a class="reference external" href="https://doi.org/10.1080/23789689.2019.1681821">https://doi.org/10.1080/23789689.2019.1681821</a></p></li>
<li><p>Sanderson, D., Kameshwar, S., Rosenheim, N., and Cox, D. (2021). Deaggregation of Multi-Hazard Damages, Losses, Risks, and Connectivity: An Application to the Joint Seismic-Tsunami Hazard at Seaside, Oregon. <em>Natural Hazards</em>. <a class="reference external" href="https://doi.org/10.1007/s11069-021-04900-9">https://doi.org/10.1007/s11069-021-04900-9</a></p></li>
<li><p>Sanderson, D., Cox, D., and Naraharisetty, G. (2021). A Spatially Explicit Decision Support Framework for Parcel- and Community-Level Resilience Assessment using Bayesian Networks. <em>Sustainable and Resilient Infrastructure</em>. <a class="reference external" href="https://doi.org/10.1080/23789689.2021.1966164">https://doi.org/10.1080/23789689.2021.1966164</a></p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks_demonstrative/dnb3"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="../dnb2/Seaside_CommDescription.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Community Description</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="../../notebooks_research/rnb1/SBN.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Spatial Bayesian Network</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Dylan Sanderson<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>